<odoo>
    <record model="report.paperformat" id="paperformat_credito_itc_reports">
        <field name="name">paperformat.asset.nota.credito.report</field>
        <field name="default" eval="True"/>
        <field name="format">Letter</field>
        <!--<field name="page_width">0</field>-->
        <!--<field name="page_width">0</field>-->
        <field name="orientation">Portrait</field>
        <!--<field name="orientation">Landscape</field>-->
        <field name="margin_top">45</field>
        <field name="margin_right">7</field>
        <field name="margin_bottom">20</field>
        <field name="margin_left">7</field>
        <field name="header_line" eval="False"/>
        <field name="header_spacing">35</field>
        <field name="dpi">90</field>
    </record>

    <report id = "report_c_nota_credito_itc"
            string = "NOTA DE CRÉDITO"
            model ="account.move"
            paperformat="paperformat_credito_itc_reports"
            file="NOTA DE CRÉDITO"
            report_type = "qweb-pdf"
            name="l10n_ni_formatos_dgi.report_nota_credito_itc_template"

    />



    <template id = "report_nota_credito_itc_template">
        <t t-foreach="docs" t-as="doc">
            <t t-call="web.html_container">
                <t t-if="doc.external_layout_aux('nota_credito') == 'true'">
                 <t t-call="web.external_layout">

                <t t-if="not o" t-set="o" t-value="doc"/>
                <t t-if="not company">
                    <!-- Multicompany -->
                    <t t-if="company_id">
                        <t t-set="company" t-value="company_id"/></t>
                    <t t-elif="o and 'company_id' in o">
                        <t t-set="company" t-value="o.company_id.sudo()"/></t>
                    <t t-else="else">
                        <t t-set="company" t-value="res_company"/></t>
                </t>
                <div class="page" style="font-size:15px">
                    <div class="row ">
                        <div class="col-8 text-right"/>
                        <div class="col-4 text-right font-weight-bold">
                            <span><b>Nota de crédito:</b></span> <span t-if="o.name" t-field="o.name"/>
                        </div>
                    </div>
                    <div class="row ">
<!--                        <div class="col-6 " style="padding:0px">-->
<!--                            <strong>Fecha:</strong>-->
<!--                            <span class="m-0" t-field="o.invoice_date"/>-->
<!--                        </div>-->
<!--                        <div class="col-6">-->
<!--                            <strong>Vendedor:</strong>-->
<!--                            <span class="m-0" t-field="o.invoice_user_id"/>-->
<!--                        </div>-->
                    </div>
                    <div class="row">
                        <div class="col-5" style="padding:0px">
                            <strong>Cliente:</strong>
                            <t t-if="o.partner_id and not o.partner_id.parent_id">


                                <span t-field="o.partner_id.name"/>
                            </t>
                            <t t-if="o.partner_id and o.partner_id.company_type == 'person' and o.partner_id.parent_id.company_type == 'company'">


                                <span t-field="o.partner_id.parent_id.name"/>
                            </t>
                        </div>
<!--                        <div class="col-3" style="padding:0px">-->
<!--                            <span>-->
<!--                                <b>RUC:</b>-->
<!--                            </span> <span t-if="o.partner_id.vat" t-field="o.partner_id.vat"/>-->
<!--                        </div>-->
<!--                        <div class="col-4" style="padding:0px">-->
<!--                            <strong>Referencia:</strong>-->
<!--                            <span class="m-0" t-field="o.ref"/>-->
<!--                        </div>-->
                    </div>
                    <div class="row">
                        <!--<div class="col-1" style="padding:0px">-->
                        <!--    <b>Dirección:</b>-->
                        <!--</div>-->
                        <div class="col-9" style="padding:0px; white-space:nowrap; overflow:hidden; text-overflow: ellipsis;">
                            <b>Dirección:</b>
                            <t t-if="o.partner_id.street">
                                <span t-field="o.partner_id.street"/>
                            </t>
                            <t t-if="o.partner_id.street2 and o.partner_id.street">
                                ,
                            </t>
                            <t t-if="o.partner_id.street2">
                                <span t-field="o.partner_id.street2"/>
                            </t>
                            <t t-if="o.partner_id.state_id">
                                ,




                                <span t-field="o.partner_id.state_id.name"/>
                            </t>
                            <t t-if="o.partner_id.city">
                                ,




                                <span t-field="o.partner_id.city"/>
                            </t>
                            <t t-if="o.partner_id.country_id">
                                ,




                                <span t-field="o.partner_id.country_id.name"/>
                            </t>
                        </div>
<!--                        <div class="col-3" style="padding:0px">-->
<!--                            <span>-->
<!--                                <b>Teléf:</b>-->
<!--                            </span>-->
<!--                             <span t-if="o.partner_id.phone" t-field="o.partner_id.phone"/>-->
<!--                        </div>-->
<!--                         <div class="col-4" style="padding:0px">-->
<!--                            <b>Forma de Pago:</b>-->
<!--                            <span t-if="o.invoice_payment_term_id" t-field="o.invoice_payment_term_id.name"/>-->
<!--                        </div>-->
                    </div>
                    <div class="row">
                        <div class="col-5" style="padding:0px;white-space:nowrap; overflow:hidden; text-overflow: ellipsis;">
                            <span><b>RUC:</b></span> <span t-if="o.partner_id.vat" t-field="o.partner_id.vat"/>
                        </div>
                        <!--<div class="col-5" style=" white-space:nowrap; overflow:hidden; text-overflow: ellipsis;">-->

                        <!--</div>-->
                        <div class="col-3" style="padding:0px">
                            <span><b>Fecha:</b></span> <span t-field="o.invoice_date"/>
                        </div>

                    </div>
                    <div class="row">
                         <div class="col-9" style="padding:0px;white-space:nowrap; overflow:hidden; text-overflow: ellipsis;">
                            <span><b>Referencia:</b></span> <span t-if="o.ref" t-field="o.ref"/>
                        </div>
                    </div>
<!--                    <div class="row " style="margin-top:3px">-->
<!--                        <div class="col-6">-->
<!--                            <span class="font-weight-bold">Hemos:</span>-->
<!--                            <span> ACREDITADO</span>-->
<!--                        </div>-->
<!--                        <div class="col-6 text-right">-->
<!--                            <span class="font-weight-bold">T/C:</span>-->
<!--                            <t t-set="tasa" t-value="1/o.type_currencychange"/>-->
<!--                            <span t-esc="'{0:,.4f}'.format(tasa) "/>-->
<!--                        </div>-->
<!--                    </div>-->
                    <t t-set="display_discount" t-value="any([l.discount for l in o.invoice_line_ids])"/>
                    <table class="table table-sm o_main_table" name="invoice_line_table">
                        <thead>
                            <tr style="padding:0px">
                                <!-- TODO: remove in master -->
                                <t t-set="colspan" t-value="6"/>
                                <th name="th_description" class="text-left" style="padding:0px">
                                    <span>Descripción</span>
                                </th>
                                <!-- TODO: remove in master -->
                                <th name="th_quantity" class="text-right" style="padding:0px">
                                    <span>Cantidad</span>
                                </th>
                                <th name="th_quantity" class="text-right" style="padding:0px">
                                    <span>UdM</span>
                                </th>
                                <th style="padding:0px" name="th_priceunit" t-attf-class="text-right {{ 'd-none d-md-table-cell' if report_type == 'html' else '' }}">
                                    <span>Precio</span>
                                </th>
                                <th style="padding:0px" name="th_price_unit" t-if="display_discount" t-attf-class="text-right {{ 'd-none d-md-table-cell' if report_type == 'html' else '' }}">
                                    <span>Desc.%</span>
                                    <!-- TODO: remove in master -->
                                    <t t-set="colspan" t-value="colspan+1"/>
                                </th>
                                <th style="padding:0px" name="th_subtotal" class="text-right">
                                    <span groups="account.group_show_line_subtotals_tax_excluded">Total</span>
                                    <span groups="account.group_show_line_subtotals_tax_included">Total</span>
                                </th>
                            </tr>
                        </thead>
                        <tbody class="invoice_tbody">
                            <t t-set="current_subtotal" t-value="0"/>
                            <t t-set="total" t-value="0"/>
                            <t t-set="total_disc" t-value="0"/>
                            <t t-set="lines" t-value="o.invoice_line_ids.sorted(key=lambda l: (-l.sequence, l.date, l.move_name, -l.id), reverse=True)"/>
                            <t t-foreach="lines" t-as="line">
                                <t t-if="line.discount">
                                    <t t-set="line_disc" t-value="line.discount / 100"/>
                                    <t t-set="cuant" t-value="line.price_unit * line.quantity"/>
                                    <t t-set="total" t-value="cuant * line_disc"/>
<!--                                    <t t-set="total" t-value="cuant * line_disc"/>-->
                                    <t t-set="total_disc" t-value="total_disc + total"/></t>
                                <t t-set="current_subtotal" t-value="current_subtotal + line.price_subtotal" groups="account.group_show_line_subtotals_tax_excluded"/>
                                <t t-set="current_subtotal" t-value="current_subtotal + line.price_total" groups="account.group_show_line_subtotals_tax_included"/>
                                <tr style="font-size:13px" t-att-class="'bg-200 font-weight-bold o_line_section' if line.display_type == 'line_section' else 'font-italic o_line_note' if line.display_type == 'line_note' else ''">
                                    <t t-if="not line.display_type" name="account_invoice_line_accountable">
                                        <td name="account_invoice_line_name" style="padding:0px">
                                            <span t-field="line.name" t-options="{'widget': 'text'}"/>
                                        </td>
                                        <td class="text-right" style="padding:0px">
                                            <span t-field="line.quantity"/>
                                        </td>
                                        <td class="text-right" style="padding:0px">
                                            <span t-field="line.product_id.uom_id"/>
                                        </td>
                                        <td style="padding:0px" t-attf-class="text-right {{ 'd-none d-md-table-cell' if report_type == 'html' else '' }}">
                                            <span class="text-nowrap" t-field="line.price_unit"/>
                                        </td>
                                        <td style="padding:0px" t-if="display_discount" t-attf-class="text-right {{ 'd-none d-md-table-cell' if report_type == 'html' else '' }}">
                                            <span class="text-nowrap" t-field="line.discount"/>
                                        </td>
                                        <td style="padding:0px" class="text-right o_price_total">
                                            <span class="text-nowrap" t-field="line.price_subtotal" groups="account.group_show_line_subtotals_tax_excluded"/>
                                            <span class="text-nowrap" t-field="line.price_total" groups="account.group_show_line_subtotals_tax_included"/>
                                        </td>
                                    </t>
                                </tr>
                                <!--<t t-if="current_section and (line_last or lines[line_index+1].display_type == 'line_section')">-->
                                <!--    <tr class="is-subtotal text-right">-->
                                <!--        <td colspan="99" style="padding:0px">-->
                                <!--            <strong class="mr16">Subtotal</strong>-->
                                <!--            <span t-esc="current_subtotal" t-options="{&quot;widget&quot;: &quot;monetary&quot;, &quot;display_currency&quot;: o.currency_id}"/>-->
                                <!--        </td>-->
                                <!--    </tr>-->
                                <!--</t>-->
                            </t>
                        </tbody>
                    </table>

                    <div class="clearfix" >
                    <div id="total" class="row">
                        <div class="col-6">
                            <t t-if="o.currency_id.name == 'USD'">
                                <span>
                                <b>Tasa de cambio:</b>
                                </span>
                                <t t-if="o.currency_id.name == 'USD'">
                                <span t-esc="'{0:,.4f}'.format(1/o.type_currencychange_usd)"/>
                                </t>
                                <t t-if="o.currency_id.name == 'NIO'">
                                <span t-esc="'{0:,.4f}'.format(1/o.type_currencychange_nic)"/>
                                </t>
                                <br/>

                                <span>
                                    <b>Total en C$:</b>
                                </span>
                                <t t-if="o.currency_id.name == 'USD'">
                                <span t-esc="'{0:,.2f}'.format(o.amount_total / o.type_currencychange_usd )"/>
                                </t>
                                <t t-if="o.currency_id.name == 'NIO'">
                                <span t-esc="'{0:,.2f}'.format( o.amount_total / o.type_currencychange_nic )"/>
                                </t>
                                </t>


                        </div>

                        <div t-attf-class="col-6">
                             <!--<div t-attf-class="#{'col-6' if report_type != 'html' else 'col-sm-7 col-md-6'} ml-auto">-->
                            <table class="table table-sm" style="page-break-inside: avoid;">
                                <tr class="border-black o_subtotal" style="padding-bottom:0px !important">
                                    <td style="padding-bottom:0px !important; padding-top:0px !important">
                                        <strong>Subtotal</strong>
                                    </td>
                                    <td class="text-right" style="padding-bottom:0px !important; padding-top:0px !important">
                                        <span t-field="o.amount_untaxed"/>
                                    </td>
                                </tr>
                                <t t-foreach="o.amount_by_group" t-as="amount_by_group">
                                        <tr style="">
                                            <t t-if="len(o.line_ids.filtered(lambda line: line.tax_line_id)) == 1 and o.amount_untaxed == amount_by_group[2]">
                                                <td style="padding:0px !important">
                                                    <!--<span class="text-nowrap" t-esc="amount_by_group[0]"/>-->
                                                    <span class="">
                                                        <strong>I.V.A</strong>
                                                    </span>
                                                </td>
                                                <td class="text-right o_price_total" style="padding-bottom:0px !important">
                                                    <span class="text-nowrap" t-esc="amount_by_group[3]"/>
                                                </td>
                                            </t>
                                            <t t-else="">
                                                <td style="padding:0px !important">
                                                    <span class="">
                                                        <strong>I.V.A</strong>
                                                    </span>
                                                    <!--<span t-esc="amount_by_group[0]"/>-->
                                                    <!--<span class="text-nowrap"> on-->
                                                    <!--    <t t-esc="amount_by_group[4]"/>-->
                                                    <!--</span>-->
                                                </td>
                                                <td class="text-right o_price_total" style="padding:0px !important">
                                                    <span class="text-nowrap" t-esc="amount_by_group[3]"/>
                                                </td>
                                            </t>
                                        </tr>
                                    </t>
<!--                                    <tr style="">-->
<!--                                        <td style="padding:0px !important">-->
<!--                                            <span class="">-->
<!--                                                <strong>Desc.</strong>-->
<!--                                            </span>-->
<!--                                        </td>-->
<!--                                        <td class="text-right o_price_total" style="padding:0px !important">-->
<!--                                            <span class="text-nowrap" t-esc="total_disc" t-options="{&quot;widget&quot;: &quot;monetary&quot;, &quot;display_currency&quot;: o.currency_id}"/>-->
<!--                                        </td>-->
<!--                                    </tr>-->
                                <tr class="border-black o_total">
                                        <td style="padding:0px !important">
                                            <strong>Total</strong>
                                        </td>
                                        <td class="text-right" style="padding:0px !important">
                                            <span class="text-nowrap" t-field="o.amount_total"/>
                                        </td>
                                    </tr>
<!--                                <t t-if="o.invoice_payments_widget != 'false'">-->
<!--                                    <t t-foreach="o.invoice_payments_widget_aux(o)" t-as="line">-->
<!--                                        <tr>-->
<!--                                             <td style="padding-bottom:0px !important; padding-top:0px !important">-->
<!--                                                <span>-->
<!--                                                    <strong>Pagado en </strong>-->
<!--                                                    <t t-set="date_aux" t-value="datetime.datetime.strptime(line['date'], '%Y-%m-%d')"/>-->
<!--&lt;!&ndash;                                                    <t t-esc="datetime.datetime.strptime(line['date'], '%Y-%m-%d')"></t>&ndash;&gt;-->
<!--                                                    <t t-esc="date_aux.strftime('%d/%m/%Y')"></t>-->
<!--                                                </span>-->
<!--                                            </td>-->
<!--                                            <td class="text-right" style="padding-bottom:0px !important; padding-top:0px !important">-->
<!--                                                <t t-esc="line['amount']" t-options="{&quot;widget&quot;: &quot;monetary&quot;, &quot;display_currency&quot;: o.currency_id}"></t>-->
<!--&lt;!&ndash;                                                t-value="datetime.datetime.strptime(date_end, '%Y-%m-%d')"&ndash;&gt;-->
<!--                                            </td>-->

<!--                                        </tr>-->
<!--                                    </t>-->
<!--                                </t>-->



<!--                                <tr >-->
<!--                                    <td style="padding-bottom:0px !important; padding-top:0px !important">-->
<!--                                        <span>-->
<!--                                            <strong>Pagado en </strong>-->
<!--                                        </span>-->
<!--                                    </td>-->
<!--                                    <td class="text-right" style="padding-bottom:0px !important; padding-top:0px !important">-->

<!--&lt;!&ndash;                                         <t t-set="lines" t-value="o._get_payments_vals()"/>&ndash;&gt;-->

<!--&lt;!&ndash;                                            <t t-foreach="lines" t-as="line">&ndash;&gt;-->
<!--&lt;!&ndash;                                                <tr>&ndash;&gt;-->
<!--&lt;!&ndash;                                                    <td style="width: 150px;">&ndash;&gt;-->
<!--&lt;!&ndash;                                                    <span><strong>Pagado en </strong></span>&ndash;&gt;-->
<!--&lt;!&ndash;                                                    <t t-esc="line['date'].strftime('%d/%m/%Y')"></t>&ndash;&gt;-->
<!--&lt;!&ndash;                                                    </td>&ndash;&gt;-->
<!--&lt;!&ndash;                                                    <td> <span style="color:white">.</span> </td>&ndash;&gt;-->
<!--&lt;!&ndash;                                                    <td><t t-esc="line['amount']" t-options="{&quot;widget&quot;: &quot;monetary&quot;, &quot;display_currency&quot;: o.currency_id}"></t> </td>&ndash;&gt;-->
<!--&lt;!&ndash;                                                </tr>&ndash;&gt;-->
<!--&lt;!&ndash;            &ndash;&gt;-->
<!--&lt;!&ndash;                                            </t>&ndash;&gt;-->




<!--                                        <t t-if="o.invoice_payments_widget != 'false'">-->

<!--                                            <span class="text-nowrap" t-esc="o.invoice_payments_widget_aux(o)"/>-->
<!--                                        </t>-->

<!--                                    </td>-->
<!--                                </tr>-->

<!--                                <t t-if="o.amount_residual > 0">-->
<!--                                    <tr>-->
<!--                                    <td style="padding-bottom:0px !important; padding-top:0px !important">-->
<!--                                        <span>-->
<!--                                            <strong>Importe adeudado  </strong>-->
<!--                                        </span>-->
<!--                                    </td>-->
<!--                                    <td class="text-right" style="padding-bottom:0px !important; padding-top:0px !important">-->
<!--                                        <t t-if="o.currency_id.name == 'USD'">-->
<!--                                            <span> $ </span> <span t-esc="o.amount_residual"/>-->
<!--                                        </t>-->
<!--                                        <t t-if="o.currency_id.name == 'NIO'">-->
<!--                                            <span> C$ </span> <span t-esc="o.amount_residual"/>-->
<!--                                        </t>-->
<!--                                    </td>-->
<!--                                </tr>-->
<!--                                </t>-->


                            </table>
                        </div>
                    </div>
                </div>
                </div>
            </t>
                </t>
                <t t-if="doc.external_layout_aux('nota_credito') == 'false'">
                    <t t-call="web.basic_layout">

                <t t-if="not o" t-set="o" t-value="doc"/>
                <t t-if="not company">
                    <!-- Multicompany -->
                    <t t-if="company_id">
                        <t t-set="company" t-value="company_id"/></t>
                    <t t-elif="o and 'company_id' in o">
                        <t t-set="company" t-value="o.company_id.sudo()"/></t>
                    <t t-else="else">
                        <t t-set="company" t-value="res_company"/></t>
                </t>
                <div class="page" style="font-size:15px">
                    <div class="row ">
                        <div class="col-8 text-right"/>
                        <div class="col-4 text-right font-weight-bold">
                            <span><b>Nota de crédito:</b></span> <span t-if="o.name" t-field="o.name"/>
                        </div>
                    </div>
                    <div class="row ">
<!--                        <div class="col-6 " style="padding:0px">-->
<!--                            <strong>Fecha:</strong>-->
<!--                            <span class="m-0" t-field="o.invoice_date"/>-->
<!--                        </div>-->
<!--                        <div class="col-6">-->
<!--                            <strong>Vendedor:</strong>-->
<!--                            <span class="m-0" t-field="o.invoice_user_id"/>-->
<!--                        </div>-->
                    </div>
                    <div class="row">
                        <div class="col-5" style="padding:0px">
                            <strong>Cliente:</strong>
                            <t t-if="o.partner_id and not o.partner_id.parent_id">


                                <span t-field="o.partner_id.name"/>
                            </t>
                            <t t-if="o.partner_id and o.partner_id.company_type == 'person' and o.partner_id.parent_id.company_type == 'company'">


                                <span t-field="o.partner_id.parent_id.name"/>
                            </t>
                        </div>
<!--                        <div class="col-3" style="padding:0px">-->
<!--                            <span>-->
<!--                                <b>RUC:</b>-->
<!--                            </span> <span t-if="o.partner_id.vat" t-field="o.partner_id.vat"/>-->
<!--                        </div>-->
<!--                        <div class="col-4" style="padding:0px">-->
<!--                            <strong>Referencia:</strong>-->
<!--                            <span class="m-0" t-field="o.ref"/>-->
<!--                        </div>-->
                    </div>
                    <div class="row">
                        <!--<div class="col-1" style="padding:0px">-->
                        <!--    <b>Dirección:</b>-->
                        <!--</div>-->
                        <div class="col-9" style="padding:0px; white-space:nowrap; overflow:hidden; text-overflow: ellipsis;">
                            <b>Dirección:</b>
                            <t t-if="o.partner_id.street">
                                <span t-field="o.partner_id.street"/>
                            </t>
                            <t t-if="o.partner_id.street2 and o.partner_id.street">
                                ,
                            </t>
                            <t t-if="o.partner_id.street2">
                                <span t-field="o.partner_id.street2"/>
                            </t>
                            <t t-if="o.partner_id.state_id">
                                ,




                                <span t-field="o.partner_id.state_id.name"/>
                            </t>
                            <t t-if="o.partner_id.city">
                                ,




                                <span t-field="o.partner_id.city"/>
                            </t>
                            <t t-if="o.partner_id.country_id">
                                ,




                                <span t-field="o.partner_id.country_id.name"/>
                            </t>
                        </div>
<!--                        <div class="col-3" style="padding:0px">-->
<!--                            <span>-->
<!--                                <b>Teléf:</b>-->
<!--                            </span>-->
<!--                             <span t-if="o.partner_id.phone" t-field="o.partner_id.phone"/>-->
<!--                        </div>-->
<!--                         <div class="col-4" style="padding:0px">-->
<!--                            <b>Forma de Pago:</b>-->
<!--                            <span t-if="o.invoice_payment_term_id" t-field="o.invoice_payment_term_id.name"/>-->
<!--                        </div>-->
                    </div>
                    <div class="row">
                        <div class="col-5" style="padding:0px;white-space:nowrap; overflow:hidden; text-overflow: ellipsis;">
                            <span><b>RUC:</b></span> <span t-if="o.partner_id.vat" t-field="o.partner_id.vat"/>
                        </div>
                        <!--<div class="col-5" style=" white-space:nowrap; overflow:hidden; text-overflow: ellipsis;">-->

                        <!--</div>-->
                        <div class="col-3" style="padding:0px">
                            <span><b>Fecha:</b></span> <span t-field="o.invoice_date"/>
                        </div>

                    </div>
                    <div class="row">
                         <div class="col-9" style="padding:0px;white-space:nowrap; overflow:hidden; text-overflow: ellipsis;">
                            <span><b>Referencia:</b></span> <span t-if="o.ref" t-field="o.ref"/>
                        </div>
                    </div>
<!--                    <div class="row " style="margin-top:3px">-->
<!--                        <div class="col-6">-->
<!--                            <span class="font-weight-bold">Hemos:</span>-->
<!--                            <span> ACREDITADO</span>-->
<!--                        </div>-->
<!--                        <div class="col-6 text-right">-->
<!--                            <span class="font-weight-bold">T/C:</span>-->
<!--                            <t t-set="tasa" t-value="1/o.type_currencychange"/>-->
<!--                            <span t-esc="'{0:,.4f}'.format(tasa) "/>-->
<!--                        </div>-->
<!--                    </div>-->
                    <t t-set="display_discount" t-value="any([l.discount for l in o.invoice_line_ids])"/>
                    <table class="table table-sm o_main_table" name="invoice_line_table">
                        <thead>
                            <tr style="padding:0px">
                                <!-- TODO: remove in master -->
                                <t t-set="colspan" t-value="6"/>
                                <th name="th_description" class="text-left" style="padding:0px">
                                    <span>Descripción</span>
                                </th>
                                <!-- TODO: remove in master -->
                                <th name="th_quantity" class="text-right" style="padding:0px">
                                    <span>Cantidad</span>
                                </th>
                                <th name="th_quantity" class="text-right" style="padding:0px">
                                    <span>UdM</span>
                                </th>
                                <th style="padding:0px" name="th_priceunit" t-attf-class="text-right {{ 'd-none d-md-table-cell' if report_type == 'html' else '' }}">
                                    <span>Precio</span>
                                </th>
                                <th style="padding:0px" name="th_price_unit" t-if="display_discount" t-attf-class="text-right {{ 'd-none d-md-table-cell' if report_type == 'html' else '' }}">
                                    <span>Desc.%</span>
                                    <!-- TODO: remove in master -->
                                    <t t-set="colspan" t-value="colspan+1"/>
                                </th>
                                <th style="padding:0px" name="th_subtotal" class="text-right">
                                    <span groups="account.group_show_line_subtotals_tax_excluded">Total</span>
                                    <span groups="account.group_show_line_subtotals_tax_included">Total</span>
                                </th>
                            </tr>
                        </thead>
                        <tbody class="invoice_tbody">
                            <t t-set="current_subtotal" t-value="0"/>
                            <t t-set="total" t-value="0"/>
                            <t t-set="total_disc" t-value="0"/>
                            <t t-set="lines" t-value="o.invoice_line_ids.sorted(key=lambda l: (-l.sequence, l.date, l.move_name, -l.id), reverse=True)"/>
                            <t t-foreach="lines" t-as="line">
                                <t t-if="line.discount">
                                    <t t-set="line_disc" t-value="line.discount / 100"/>
                                    <t t-set="cuant" t-value="line.price_unit * line.quantity"/>
                                    <t t-set="total" t-value="cuant * line_disc"/>
<!--                                    <t t-set="total" t-value="cuant * line_disc"/>-->
                                    <t t-set="total_disc" t-value="total_disc + total"/></t>
                                <t t-set="current_subtotal" t-value="current_subtotal + line.price_subtotal" groups="account.group_show_line_subtotals_tax_excluded"/>
                                <t t-set="current_subtotal" t-value="current_subtotal + line.price_total" groups="account.group_show_line_subtotals_tax_included"/>
                                <tr style="font-size:13px" t-att-class="'bg-200 font-weight-bold o_line_section' if line.display_type == 'line_section' else 'font-italic o_line_note' if line.display_type == 'line_note' else ''">
                                    <t t-if="not line.display_type" name="account_invoice_line_accountable">
                                        <td name="account_invoice_line_name" style="padding:0px">
                                            <span t-field="line.name" t-options="{'widget': 'text'}"/>
                                        </td>
                                        <td class="text-right" style="padding:0px">
                                            <span t-field="line.quantity"/>
                                        </td>
                                        <td class="text-right" style="padding:0px">
                                            <span t-field="line.product_id.uom_id"/>
                                        </td>
                                        <td style="padding:0px" t-attf-class="text-right {{ 'd-none d-md-table-cell' if report_type == 'html' else '' }}">
                                            <span class="text-nowrap" t-field="line.price_unit"/>
                                        </td>
                                        <td style="padding:0px" t-if="display_discount" t-attf-class="text-right {{ 'd-none d-md-table-cell' if report_type == 'html' else '' }}">
                                            <span class="text-nowrap" t-field="line.discount"/>
                                        </td>
                                        <td style="padding:0px" class="text-right o_price_total">
                                            <span class="text-nowrap" t-field="line.price_subtotal" groups="account.group_show_line_subtotals_tax_excluded"/>
                                            <span class="text-nowrap" t-field="line.price_total" groups="account.group_show_line_subtotals_tax_included"/>
                                        </td>
                                    </t>
                                </tr>
                                <!--<t t-if="current_section and (line_last or lines[line_index+1].display_type == 'line_section')">-->
                                <!--    <tr class="is-subtotal text-right">-->
                                <!--        <td colspan="99" style="padding:0px">-->
                                <!--            <strong class="mr16">Subtotal</strong>-->
                                <!--            <span t-esc="current_subtotal" t-options="{&quot;widget&quot;: &quot;monetary&quot;, &quot;display_currency&quot;: o.currency_id}"/>-->
                                <!--        </td>-->
                                <!--    </tr>-->
                                <!--</t>-->
                            </t>
                        </tbody>
                    </table>

                    <div class="clearfix" >
                    <div id="total" class="row">
                        <div class="col-6">
                            <t t-if="o.currency_id.name == 'USD'">
                                <span>
                                <b>Tasa de cambio:</b>
                                </span>
                                <t t-if="o.currency_id.name == 'USD'">
                                <span t-esc="'{0:,.4f}'.format(1/o.type_currencychange_usd)"/>
                                </t>
                                <t t-if="o.currency_id.name == 'NIO'">
                                <span t-esc="'{0:,.4f}'.format(1/o.type_currencychange_nic)"/>
                                </t>
                                <br/>

                                <span>
                                    <b>Total en C$:</b>
                                </span>
                                <t t-if="o.currency_id.name == 'USD'">
                                <span t-esc="'{0:,.2f}'.format(o.amount_total / o.type_currencychange_usd )"/>
                                </t>
                                <t t-if="o.currency_id.name == 'NIO'">
                                <span t-esc="'{0:,.2f}'.format( o.amount_total / o.type_currencychange_nic )"/>
                                </t>
                                </t>


                        </div>

                        <div t-attf-class="col-6">
                             <!--<div t-attf-class="#{'col-6' if report_type != 'html' else 'col-sm-7 col-md-6'} ml-auto">-->
                            <table class="table table-sm" style="page-break-inside: avoid;">
                                <tr class="border-black o_subtotal" style="padding-bottom:0px !important">
                                    <td style="padding-bottom:0px !important; padding-top:0px !important">
                                        <strong>Subtotal</strong>
                                    </td>
                                    <td class="text-right" style="padding-bottom:0px !important; padding-top:0px !important">
                                        <span t-field="o.amount_untaxed"/>
                                    </td>
                                </tr>
                                <t t-foreach="o.amount_by_group" t-as="amount_by_group">
                                        <tr style="">
                                            <t t-if="len(o.line_ids.filtered(lambda line: line.tax_line_id)) == 1 and o.amount_untaxed == amount_by_group[2]">
                                                <td style="padding:0px !important">
                                                    <!--<span class="text-nowrap" t-esc="amount_by_group[0]"/>-->
                                                    <span class="">
                                                        <strong>I.V.A</strong>
                                                    </span>
                                                </td>
                                                <td class="text-right o_price_total" style="padding-bottom:0px !important">
                                                    <span class="text-nowrap" t-esc="amount_by_group[3]"/>
                                                </td>
                                            </t>
                                            <t t-else="">
                                                <td style="padding:0px !important">
                                                    <span class="">
                                                        <strong>I.V.A</strong>
                                                    </span>
                                                    <!--<span t-esc="amount_by_group[0]"/>-->
                                                    <!--<span class="text-nowrap"> on-->
                                                    <!--    <t t-esc="amount_by_group[4]"/>-->
                                                    <!--</span>-->
                                                </td>
                                                <td class="text-right o_price_total" style="padding:0px !important">
                                                    <span class="text-nowrap" t-esc="amount_by_group[3]"/>
                                                </td>
                                            </t>
                                        </tr>
                                    </t>
<!--                                    <tr style="">-->
<!--                                        <td style="padding:0px !important">-->
<!--                                            <span class="">-->
<!--                                                <strong>Desc.</strong>-->
<!--                                            </span>-->
<!--                                        </td>-->
<!--                                        <td class="text-right o_price_total" style="padding:0px !important">-->
<!--                                            <span class="text-nowrap" t-esc="total_disc" t-options="{&quot;widget&quot;: &quot;monetary&quot;, &quot;display_currency&quot;: o.currency_id}"/>-->
<!--                                        </td>-->
<!--                                    </tr>-->
                                <tr class="border-black o_total">
                                        <td style="padding:0px !important">
                                            <strong>Total</strong>
                                        </td>
                                        <td class="text-right" style="padding:0px !important">
                                            <span class="text-nowrap" t-field="o.amount_total"/>
                                        </td>
                                    </tr>
<!--                                <t t-if="o.invoice_payments_widget != 'false'">-->
<!--                                    <t t-foreach="o.invoice_payments_widget_aux(o)" t-as="line">-->
<!--                                        <tr>-->
<!--                                             <td style="padding-bottom:0px !important; padding-top:0px !important">-->
<!--                                                <span>-->
<!--                                                    <strong>Pagado en </strong>-->
<!--                                                    <t t-set="date_aux" t-value="datetime.datetime.strptime(line['date'], '%Y-%m-%d')"/>-->
<!--&lt;!&ndash;                                                    <t t-esc="datetime.datetime.strptime(line['date'], '%Y-%m-%d')"></t>&ndash;&gt;-->
<!--                                                    <t t-esc="date_aux.strftime('%d/%m/%Y')"></t>-->
<!--                                                </span>-->
<!--                                            </td>-->
<!--                                            <td class="text-right" style="padding-bottom:0px !important; padding-top:0px !important">-->
<!--                                                <t t-esc="line['amount']" t-options="{&quot;widget&quot;: &quot;monetary&quot;, &quot;display_currency&quot;: o.currency_id}"></t>-->
<!--&lt;!&ndash;                                                t-value="datetime.datetime.strptime(date_end, '%Y-%m-%d')"&ndash;&gt;-->
<!--                                            </td>-->

<!--                                        </tr>-->
<!--                                    </t>-->
<!--                                </t>-->



<!--                                <tr >-->
<!--                                    <td style="padding-bottom:0px !important; padding-top:0px !important">-->
<!--                                        <span>-->
<!--                                            <strong>Pagado en </strong>-->
<!--                                        </span>-->
<!--                                    </td>-->
<!--                                    <td class="text-right" style="padding-bottom:0px !important; padding-top:0px !important">-->

<!--&lt;!&ndash;                                         <t t-set="lines" t-value="o._get_payments_vals()"/>&ndash;&gt;-->

<!--&lt;!&ndash;                                            <t t-foreach="lines" t-as="line">&ndash;&gt;-->
<!--&lt;!&ndash;                                                <tr>&ndash;&gt;-->
<!--&lt;!&ndash;                                                    <td style="width: 150px;">&ndash;&gt;-->
<!--&lt;!&ndash;                                                    <span><strong>Pagado en </strong></span>&ndash;&gt;-->
<!--&lt;!&ndash;                                                    <t t-esc="line['date'].strftime('%d/%m/%Y')"></t>&ndash;&gt;-->
<!--&lt;!&ndash;                                                    </td>&ndash;&gt;-->
<!--&lt;!&ndash;                                                    <td> <span style="color:white">.</span> </td>&ndash;&gt;-->
<!--&lt;!&ndash;                                                    <td><t t-esc="line['amount']" t-options="{&quot;widget&quot;: &quot;monetary&quot;, &quot;display_currency&quot;: o.currency_id}"></t> </td>&ndash;&gt;-->
<!--&lt;!&ndash;                                                </tr>&ndash;&gt;-->
<!--&lt;!&ndash;            &ndash;&gt;-->
<!--&lt;!&ndash;                                            </t>&ndash;&gt;-->




<!--                                        <t t-if="o.invoice_payments_widget != 'false'">-->

<!--                                            <span class="text-nowrap" t-esc="o.invoice_payments_widget_aux(o)"/>-->
<!--                                        </t>-->

<!--                                    </td>-->
<!--                                </tr>-->

<!--                                <t t-if="o.amount_residual > 0">-->
<!--                                    <tr>-->
<!--                                    <td style="padding-bottom:0px !important; padding-top:0px !important">-->
<!--                                        <span>-->
<!--                                            <strong>Importe adeudado  </strong>-->
<!--                                        </span>-->
<!--                                    </td>-->
<!--                                    <td class="text-right" style="padding-bottom:0px !important; padding-top:0px !important">-->
<!--                                        <t t-if="o.currency_id.name == 'USD'">-->
<!--                                            <span> $ </span> <span t-esc="o.amount_residual"/>-->
<!--                                        </t>-->
<!--                                        <t t-if="o.currency_id.name == 'NIO'">-->
<!--                                            <span> C$ </span> <span t-esc="o.amount_residual"/>-->
<!--                                        </t>-->
<!--                                    </td>-->
<!--                                </tr>-->
<!--                                </t>-->


                            </table>
                        </div>
                    </div>
                </div>
                </div>
            </t>
                </t>

            </t>
        </t>

    </template>




    <record model="report.paperformat" id="paperformat_debito_itc_reports">
        <field name="name">paperformat.asset.nota.debito.report</field>
        <field name="default" eval="True"/>
        <field name="format">Letter</field>
        <!--<field name="page_width">0</field>-->
        <!--<field name="page_width">0</field>-->
        <field name="orientation">Portrait</field>
        <!--<field name="orientation">Landscape</field>-->
        <field name="margin_top">45</field>
        <field name="margin_right">7</field>
        <field name="margin_bottom">20</field>
        <field name="margin_left">7</field>
        <field name="header_line" eval="False"/>
        <field name="header_spacing">35</field>
        <field name="dpi">90</field>
    </record>

    <report id = "report_c_nota_debito_itc"
            string = "NOTA DE DÉBITO"
            model ="account.move"
            paperformat="paperformat_debito_itc_reports"
            file="NOTA DE DÉBITO"
            report_type = "qweb-pdf"
            name="l10n_ni_formatos_dgi.report_nota_debito_itc_template"

    />

    <template id = "report_nota_debito_itc_template">
        <t t-foreach="docs" t-as="doc">
            <t t-call="web.html_container">

                <t t-if="doc.external_layout_aux('nota_debito') == 'true'">
                    <t t-call="web.external_layout">
                <t t-if="not o" t-set="o" t-value="doc"/>
                <t t-if="not company">
                    <!-- Multicompany -->
                    <t t-if="company_id">
                        <t t-set="company" t-value="company_id"/></t>
                    <t t-elif="o and 'company_id' in o">
                        <t t-set="company" t-value="o.company_id.sudo()"/></t>
                    <t t-else="else">
                        <t t-set="company" t-value="res_company"/></t>
                </t>
                <div class="page" style="font-size:15px">
                    <div class="row ">
                        <div class="col-8 text-right"/>
                        <div class="col-4 text-right font-weight-bold">
                            <span><b>Nota de débito:</b></span> <span t-if="o.name" t-field="o.name"/>
                        </div>
                    </div>
<!--                    <div class="row ">-->
<!--                        <div class="col-6 " style="padding:0px">-->
<!--                            <strong>Fecha:</strong>-->
<!--                            <span class="m-0" t-field="o.invoice_date"/>-->
<!--                        </div>-->
<!--&lt;!&ndash;                        <div class="col-6">&ndash;&gt;-->
<!--&lt;!&ndash;                            <strong>Vendedor:</strong>&ndash;&gt;-->
<!--&lt;!&ndash;                            <span class="m-0" t-field="o.invoice_user_id"/>&ndash;&gt;-->
<!--&lt;!&ndash;                        </div>&ndash;&gt;-->
<!--                    </div>-->
                    <div class="row">
                        <div class="col-5" style="padding:0px">
                            <strong>Cliente:</strong>
                            <t t-if="o.partner_id and not o.partner_id.parent_id">


                                <span t-field="o.partner_id.name"/>
                            </t>
                            <t t-if="o.partner_id and o.partner_id.company_type == 'person' and o.partner_id.parent_id.company_type == 'company'">


                                <span t-field="o.partner_id.parent_id.name"/>
                            </t>
                        </div>
<!--                        <div class="col-3" style="padding:0px">-->
<!--                            <span>-->
<!--                                <b>RUC:</b>-->
<!--                            </span> <span t-if="o.partner_id.vat" t-field="o.partner_id.vat"/>-->
<!--                        </div>-->
<!--                        <div class="col-4" style="padding:0px">-->
<!--                            <strong>Referencia:</strong>-->
<!--                            <span class="m-0" t-field="o.ref"/>-->
<!--                        </div>-->
                    </div>
                    <div class="row">
                        <!--<div class="col-1" style="padding:0px">-->
                        <!--    <b>Dirección:</b>-->
                        <!--</div>-->
                        <div class="col-9" style="padding:0px; white-space:nowrap; overflow:hidden; text-overflow: ellipsis;">
                            <b>Dirección:</b>
                            <t t-if="o.partner_id.street">
                                <span t-field="o.partner_id.street"/>
                            </t>
                            <t t-if="o.partner_id.street2 and o.partner_id.street">
                                ,
                            </t>
                            <t t-if="o.partner_id.street2">
                                <span t-field="o.partner_id.street2"/>
                            </t>
                            <t t-if="o.partner_id.state_id">
                                ,




                                <span t-field="o.partner_id.state_id.name"/>
                            </t>
                            <t t-if="o.partner_id.city">
                                ,




                                <span t-field="o.partner_id.city"/>
                            </t>
                            <t t-if="o.partner_id.country_id">
                                ,




                                <span t-field="o.partner_id.country_id.name"/>
                            </t>
                        </div>
<!--                        <div class="col-3" style="padding:0px">-->
<!--                            <span>-->
<!--                                <b>Teléf:</b>-->
<!--                            </span>-->
<!--                             <span t-if="o.partner_id.phone" t-field="o.partner_id.phone"/>-->
<!--                        </div>-->
<!--                         <div class="col-4" style="padding:0px">-->
<!--                            <b>Forma de Pago:</b>-->
<!--                            <span t-if="o.invoice_payment_term_id" t-field="o.invoice_payment_term_id.name"/>-->
<!--                        </div>-->
                    </div>
                    <div class="row">
                        <div class="col-5" style="padding:0px;white-space:nowrap; overflow:hidden; text-overflow: ellipsis;">
                            <span><b>RUC:</b></span> <span t-if="o.partner_id.vat" t-field="o.partner_id.vat"/>
                        </div>
                        <!--<div class="col-5" style=" white-space:nowrap; overflow:hidden; text-overflow: ellipsis;">-->

                        <!--</div>-->
                        <div class="col-3" style="padding:0px">
                            <span><b>Fecha:</b></span> <span t-field="o.invoice_date"/>
                        </div>

                    </div>
                     <div class="row">
                         <div class="col-9" style="padding:0px;white-space:nowrap; overflow:hidden; text-overflow: ellipsis;">
                            <span><b>Referencia:</b></span> <span t-if="o.ref" t-field="o.ref"/>
                        </div>
                    </div>

<!--                    <div class="row " style="margin-top:3px">-->
<!--                        <div class="col-6">-->
<!--                            <span class="font-weight-bold">Hemos:</span>-->
<!--                            <span> ACREDITADO</span>-->
<!--                        </div>-->
<!--                        <div class="col-6 text-right">-->
<!--                            <span class="font-weight-bold">T/C:</span>-->
<!--                            <t t-set="tasa" t-value="1/o.type_currencychange"/>-->
<!--                            <span t-esc="'{0:,.4f}'.format(tasa) "/>-->
<!--                        </div>-->
<!--                    </div>-->
                    <t t-set="display_discount" t-value="any([l.discount for l in o.invoice_line_ids])"/>
                    <table class="table table-sm o_main_table" name="invoice_line_table">
                        <thead>
                            <tr style="padding:0px">
                                <!-- TODO: remove in master -->
                                <t t-set="colspan" t-value="6"/>
                                <th name="th_description" class="text-left" style="padding:0px">
                                    <span>Descripción</span>
                                </th>
                                <!-- TODO: remove in master -->
                                <th name="th_quantity" class="text-right" style="padding:0px">
                                    <span>Cantidad</span>
                                </th>
                                <th name="th_quantity" class="text-right" style="padding:0px">
                                    <span>UdM</span>
                                </th>
                                <th style="padding:0px" name="th_priceunit" t-attf-class="text-right {{ 'd-none d-md-table-cell' if report_type == 'html' else '' }}">
                                    <span>Precio</span>
                                </th>
                                <th style="padding:0px" name="th_price_unit" t-if="display_discount" t-attf-class="text-right {{ 'd-none d-md-table-cell' if report_type == 'html' else '' }}">
                                    <span>Desc.%</span>
                                    <!-- TODO: remove in master -->
                                    <t t-set="colspan" t-value="colspan+1"/>
                                </th>
                                <th style="padding:0px" name="th_subtotal" class="text-right">
                                    <span groups="account.group_show_line_subtotals_tax_excluded">Total</span>
                                    <span groups="account.group_show_line_subtotals_tax_included">Total</span>
                                </th>
                            </tr>
                        </thead>
                        <tbody class="invoice_tbody">
                            <t t-set="current_subtotal" t-value="0"/>
                            <t t-set="total" t-value="0"/>
                            <t t-set="total_disc" t-value="0"/>
                            <t t-set="lines" t-value="o.invoice_line_ids.sorted(key=lambda l: (-l.sequence, l.date, l.move_name, -l.id), reverse=True)"/>
                            <t t-foreach="lines" t-as="line">
                                <t t-if="line.discount">
                                    <t t-set="line_disc" t-value="line.discount / 100"/>
                                    <t t-set="cuant" t-value="line.price_unit * line.quantity"/>
                                    <t t-set="total" t-value="cuant * line_disc"/>
                                    <t t-set="total_disc" t-value="total_disc + total"/></t>
                                <t t-set="current_subtotal" t-value="current_subtotal + line.price_subtotal" groups="account.group_show_line_subtotals_tax_excluded"/>
                                <t t-set="current_subtotal" t-value="current_subtotal + line.price_total" groups="account.group_show_line_subtotals_tax_included"/>
                                <tr style="font-size:13px" t-att-class="'bg-200 font-weight-bold o_line_section' if line.display_type == 'line_section' else 'font-italic o_line_note' if line.display_type == 'line_note' else ''">
                                    <t t-if="not line.display_type" name="account_invoice_line_accountable">
                                        <td name="account_invoice_line_name" style="padding:0px">
                                            <span t-field="line.name" t-options="{'widget': 'text'}"/>
                                        </td>
                                        <td class="text-right" style="padding:0px">
                                            <span t-field="line.quantity"/>
                                        </td>
                                        <td class="text-right" style="padding:0px">
                                            <span t-field="line.product_id.uom_id"/>
                                        </td>
                                        <td style="padding:0px" t-attf-class="text-right {{ 'd-none d-md-table-cell' if report_type == 'html' else '' }}">
                                            <span class="text-nowrap" t-field="line.price_unit"/>
                                        </td>
                                        <td style="padding:0px" t-if="display_discount" t-attf-class="text-right {{ 'd-none d-md-table-cell' if report_type == 'html' else '' }}">
                                            <span class="text-nowrap" t-field="line.discount"/>
                                        </td>
                                        <td style="padding:0px" class="text-right o_price_total">
                                            <span class="text-nowrap" t-field="line.price_subtotal" groups="account.group_show_line_subtotals_tax_excluded"/>
                                            <span class="text-nowrap" t-field="line.price_total" groups="account.group_show_line_subtotals_tax_included"/>
                                        </td>
                                    </t>
                                </tr>
                                <!--<t t-if="current_section and (line_last or lines[line_index+1].display_type == 'line_section')">-->
                                <!--    <tr class="is-subtotal text-right">-->
                                <!--        <td colspan="99" style="padding:0px">-->
                                <!--            <strong class="mr16">Subtotal</strong>-->
                                <!--            <span t-esc="current_subtotal" t-options="{&quot;widget&quot;: &quot;monetary&quot;, &quot;display_currency&quot;: o.currency_id}"/>-->
                                <!--        </td>-->
                                <!--    </tr>-->
                                <!--</t>-->
                            </t>
                        </tbody>
                    </table>
                    <div class="clearfix" >
                    <div id="total" class="row">
                        <div class="col-6">
                            <t t-if="o.currency_id.name == 'USD'">
                                <span>
                                <b>Tasa de cambio:</b>
                                </span>
                                <t t-if="o.currency_id.name == 'USD'">
                                <span t-esc="'{0:,.4f}'.format(1/o.type_currencychange_usd)"/>
                                </t>
                                <t t-if="o.currency_id.name == 'NIO'">
                                <span t-esc="'{0:,.4f}'.format(1/o.type_currencychange_nic)"/>
                                </t>
                                <br/>

                                <span>
                                    <b>Total en C$:</b>
                                </span>
                                <t t-if="o.currency_id.name == 'USD'">
                                <span t-esc="'{0:,.2f}'.format(o.amount_total / o.type_currencychange_usd )"/>
                                </t>
                                <t t-if="o.currency_id.name == 'NIO'">
                                <span t-esc="'{0:,.2f}'.format( o.amount_total / o.type_currencychange_nic )"/>
                                </t>
                                </t>


                        </div>

                        <div t-attf-class="col-6">
                             <!--<div t-attf-class="#{'col-6' if report_type != 'html' else 'col-sm-7 col-md-6'} ml-auto">-->
                            <table class="table table-sm" style="page-break-inside: avoid;">
                                <tr class="border-black o_subtotal" style="padding-bottom:0px !important">
                                    <td style="padding-bottom:0px !important; padding-top:0px !important">
                                        <strong>Subtotal</strong>
                                    </td>
                                    <td class="text-right" style="padding-bottom:0px !important; padding-top:0px !important">
                                        <span t-field="o.amount_untaxed"/>
                                    </td>
                                </tr>
                                <t t-foreach="o.amount_by_group" t-as="amount_by_group">
                                        <tr style="">
                                            <t t-if="len(o.line_ids.filtered(lambda line: line.tax_line_id)) == 1 and o.amount_untaxed == amount_by_group[2]">
                                                <td style="padding:0px !important">
                                                    <!--<span class="text-nowrap" t-esc="amount_by_group[0]"/>-->
                                                    <span class="">
                                                        <strong>I.V.A</strong>
                                                    </span>
                                                </td>
                                                <td class="text-right o_price_total" style="padding-bottom:0px !important">
                                                    <span class="text-nowrap" t-esc="amount_by_group[3]"/>
                                                </td>
                                            </t>
                                            <t t-else="">
                                                <td style="padding:0px !important">
                                                    <span class="">
                                                        <strong>I.V.A</strong>
                                                    </span>
                                                    <!--<span t-esc="amount_by_group[0]"/>-->
                                                    <!--<span class="text-nowrap"> on-->
                                                    <!--    <t t-esc="amount_by_group[4]"/>-->
                                                    <!--</span>-->
                                                </td>
                                                <td class="text-right o_price_total" style="padding:0px !important">
                                                    <span class="text-nowrap" t-esc="amount_by_group[3]"/>
                                                </td>
                                            </t>
                                        </tr>
                                    </t>
<!--                                    <tr style="">-->
<!--                                        <td style="padding:0px !important">-->
<!--                                            <span class="">-->
<!--                                                <strong>Desc.</strong>-->
<!--                                            </span>-->
<!--                                        </td>-->
<!--                                        <td class="text-right o_price_total" style="padding:0px !important">-->
<!--                                            <span class="text-nowrap" t-esc="total_disc" t-options="{&quot;widget&quot;: &quot;monetary&quot;, &quot;display_currency&quot;: o.currency_id}"/>-->
<!--                                        </td>-->
<!--                                    </tr>-->
                                <tr class="border-black o_total">
                                        <td style="padding:0px !important">
                                            <strong>Total</strong>
                                        </td>
                                        <td class="text-right" style="padding:0px !important">
                                            <span class="text-nowrap" t-field="o.amount_total"/>
                                        </td>
                                    </tr>
<!--                                <t t-if="o.invoice_payments_widget != 'false'">-->
<!--                                    <t t-foreach="o.invoice_payments_widget_aux(o)" t-as="line">-->
<!--                                        <tr>-->
<!--                                             <td style="padding-bottom:0px !important; padding-top:0px !important">-->
<!--                                                <span>-->
<!--                                                    <strong>Pagado en </strong>-->
<!--                                                    <t t-set="date_aux" t-value="datetime.datetime.strptime(line['date'], '%Y-%m-%d')"/>-->
<!--&lt;!&ndash;                                                    <t t-esc="datetime.datetime.strptime(line['date'], '%Y-%m-%d')"></t>&ndash;&gt;-->
<!--                                                    <t t-esc="date_aux.strftime('%d/%m/%Y')"></t>-->
<!--                                                </span>-->
<!--                                            </td>-->
<!--                                            <td class="text-right" style="padding-bottom:0px !important; padding-top:0px !important">-->
<!--                                                <t t-esc="line['amount']" t-options="{&quot;widget&quot;: &quot;monetary&quot;, &quot;display_currency&quot;: o.currency_id}"></t>-->
<!--&lt;!&ndash;                                                t-value="datetime.datetime.strptime(date_end, '%Y-%m-%d')"&ndash;&gt;-->
<!--                                            </td>-->

<!--                                        </tr>-->
<!--                                    </t>-->
<!--                                </t>-->



<!--                                <tr >-->
<!--                                    <td style="padding-bottom:0px !important; padding-top:0px !important">-->
<!--                                        <span>-->
<!--                                            <strong>Pagado en </strong>-->
<!--                                        </span>-->
<!--                                    </td>-->
<!--                                    <td class="text-right" style="padding-bottom:0px !important; padding-top:0px !important">-->

<!--&lt;!&ndash;                                         <t t-set="lines" t-value="o._get_payments_vals()"/>&ndash;&gt;-->

<!--&lt;!&ndash;                                            <t t-foreach="lines" t-as="line">&ndash;&gt;-->
<!--&lt;!&ndash;                                                <tr>&ndash;&gt;-->
<!--&lt;!&ndash;                                                    <td style="width: 150px;">&ndash;&gt;-->
<!--&lt;!&ndash;                                                    <span><strong>Pagado en </strong></span>&ndash;&gt;-->
<!--&lt;!&ndash;                                                    <t t-esc="line['date'].strftime('%d/%m/%Y')"></t>&ndash;&gt;-->
<!--&lt;!&ndash;                                                    </td>&ndash;&gt;-->
<!--&lt;!&ndash;                                                    <td> <span style="color:white">.</span> </td>&ndash;&gt;-->
<!--&lt;!&ndash;                                                    <td><t t-esc="line['amount']" t-options="{&quot;widget&quot;: &quot;monetary&quot;, &quot;display_currency&quot;: o.currency_id}"></t> </td>&ndash;&gt;-->
<!--&lt;!&ndash;                                                </tr>&ndash;&gt;-->
<!--&lt;!&ndash;            &ndash;&gt;-->
<!--&lt;!&ndash;                                            </t>&ndash;&gt;-->




<!--                                        <t t-if="o.invoice_payments_widget != 'false'">-->

<!--                                            <span class="text-nowrap" t-esc="o.invoice_payments_widget_aux(o)"/>-->
<!--                                        </t>-->

<!--                                    </td>-->
<!--                                </tr>-->

<!--                                <t t-if="o.amount_residual > 0">-->
<!--                                    <tr>-->
<!--                                    <td style="padding-bottom:0px !important; padding-top:0px !important">-->
<!--                                        <span>-->
<!--                                            <strong>Importe adeudado  </strong>-->
<!--                                        </span>-->
<!--                                    </td>-->
<!--                                    <td class="text-right" style="padding-bottom:0px !important; padding-top:0px !important">-->
<!--                                        <t t-if="o.currency_id.name == 'USD'">-->
<!--                                            <span> $ </span> <span t-esc="o.amount_residual"/>-->
<!--                                        </t>-->
<!--                                        <t t-if="o.currency_id.name == 'NIO'">-->
<!--                                            <span> C$ </span> <span t-esc="o.amount_residual"/>-->
<!--                                        </t>-->
<!--                                    </td>-->
<!--                                </tr>-->
<!--                                </t>-->


                            </table>
                        </div>
                    </div>
                </div>
                </div>
            </t>
                </t>

                <t t-if="doc.external_layout_aux('nota_debito') == 'false'">
                    <t t-call="web.basic_layout">
                <t t-if="not o" t-set="o" t-value="doc"/>
                <t t-if="not company">
                    <!-- Multicompany -->
                    <t t-if="company_id">
                        <t t-set="company" t-value="company_id"/></t>
                    <t t-elif="o and 'company_id' in o">
                        <t t-set="company" t-value="o.company_id.sudo()"/></t>
                    <t t-else="else">
                        <t t-set="company" t-value="res_company"/></t>
                </t>
                <div class="page" style="font-size:15px">
                    <div class="row ">
                        <div class="col-8 text-right"/>
                        <div class="col-4 text-right font-weight-bold">
                            <span><b>Nota de débito:</b></span> <span t-if="o.name" t-field="o.name"/>
                        </div>
                    </div>
<!--                    <div class="row ">-->
<!--                        <div class="col-6 " style="padding:0px">-->
<!--                            <strong>Fecha:</strong>-->
<!--                            <span class="m-0" t-field="o.invoice_date"/>-->
<!--                        </div>-->
<!--&lt;!&ndash;                        <div class="col-6">&ndash;&gt;-->
<!--&lt;!&ndash;                            <strong>Vendedor:</strong>&ndash;&gt;-->
<!--&lt;!&ndash;                            <span class="m-0" t-field="o.invoice_user_id"/>&ndash;&gt;-->
<!--&lt;!&ndash;                        </div>&ndash;&gt;-->
<!--                    </div>-->
                    <div class="row">
                        <div class="col-5" style="padding:0px">
                            <strong>Cliente:</strong>
                            <t t-if="o.partner_id and not o.partner_id.parent_id">


                                <span t-field="o.partner_id.name"/>
                            </t>
                            <t t-if="o.partner_id and o.partner_id.company_type == 'person' and o.partner_id.parent_id.company_type == 'company'">


                                <span t-field="o.partner_id.parent_id.name"/>
                            </t>
                        </div>
<!--                        <div class="col-3" style="padding:0px">-->
<!--                            <span>-->
<!--                                <b>RUC:</b>-->
<!--                            </span> <span t-if="o.partner_id.vat" t-field="o.partner_id.vat"/>-->
<!--                        </div>-->
<!--                        <div class="col-4" style="padding:0px">-->
<!--                            <strong>Referencia:</strong>-->
<!--                            <span class="m-0" t-field="o.ref"/>-->
<!--                        </div>-->
                    </div>
                    <div class="row">
                        <!--<div class="col-1" style="padding:0px">-->
                        <!--    <b>Dirección:</b>-->
                        <!--</div>-->
                        <div class="col-9" style="padding:0px; white-space:nowrap; overflow:hidden; text-overflow: ellipsis;">
                            <b>Dirección:</b>
                            <t t-if="o.partner_id.street">
                                <span t-field="o.partner_id.street"/>
                            </t>
                            <t t-if="o.partner_id.street2 and o.partner_id.street">
                                ,
                            </t>
                            <t t-if="o.partner_id.street2">
                                <span t-field="o.partner_id.street2"/>
                            </t>
                            <t t-if="o.partner_id.state_id">
                                ,




                                <span t-field="o.partner_id.state_id.name"/>
                            </t>
                            <t t-if="o.partner_id.city">
                                ,




                                <span t-field="o.partner_id.city"/>
                            </t>
                            <t t-if="o.partner_id.country_id">
                                ,




                                <span t-field="o.partner_id.country_id.name"/>
                            </t>
                        </div>
<!--                        <div class="col-3" style="padding:0px">-->
<!--                            <span>-->
<!--                                <b>Teléf:</b>-->
<!--                            </span>-->
<!--                             <span t-if="o.partner_id.phone" t-field="o.partner_id.phone"/>-->
<!--                        </div>-->
<!--                         <div class="col-4" style="padding:0px">-->
<!--                            <b>Forma de Pago:</b>-->
<!--                            <span t-if="o.invoice_payment_term_id" t-field="o.invoice_payment_term_id.name"/>-->
<!--                        </div>-->
                    </div>
                    <div class="row">
                        <div class="col-5" style="padding:0px;white-space:nowrap; overflow:hidden; text-overflow: ellipsis;">
                            <span><b>RUC:</b></span> <span t-if="o.partner_id.vat" t-field="o.partner_id.vat"/>
                        </div>
                        <!--<div class="col-5" style=" white-space:nowrap; overflow:hidden; text-overflow: ellipsis;">-->

                        <!--</div>-->
                        <div class="col-3" style="padding:0px">
                            <span><b>Fecha:</b></span> <span t-field="o.invoice_date"/>
                        </div>

                    </div>
                     <div class="row">
                         <div class="col-9" style="padding:0px;white-space:nowrap; overflow:hidden; text-overflow: ellipsis;">
                            <span><b>Referencia:</b></span> <span t-if="o.ref" t-field="o.ref"/>
                        </div>
                    </div>

<!--                    <div class="row " style="margin-top:3px">-->
<!--                        <div class="col-6">-->
<!--                            <span class="font-weight-bold">Hemos:</span>-->
<!--                            <span> ACREDITADO</span>-->
<!--                        </div>-->
<!--                        <div class="col-6 text-right">-->
<!--                            <span class="font-weight-bold">T/C:</span>-->
<!--                            <t t-set="tasa" t-value="1/o.type_currencychange"/>-->
<!--                            <span t-esc="'{0:,.4f}'.format(tasa) "/>-->
<!--                        </div>-->
<!--                    </div>-->
                    <t t-set="display_discount" t-value="any([l.discount for l in o.invoice_line_ids])"/>
                    <table class="table table-sm o_main_table" name="invoice_line_table">
                        <thead>
                            <tr style="padding:0px">
                                <!-- TODO: remove in master -->
                                <t t-set="colspan" t-value="6"/>
                                <th name="th_description" class="text-left" style="padding:0px">
                                    <span>Descripción</span>
                                </th>
                                <!-- TODO: remove in master -->
                                <th name="th_quantity" class="text-right" style="padding:0px">
                                    <span>Cantidad</span>
                                </th>
                                <th name="th_quantity" class="text-right" style="padding:0px">
                                    <span>UdM</span>
                                </th>
                                <th style="padding:0px" name="th_priceunit" t-attf-class="text-right {{ 'd-none d-md-table-cell' if report_type == 'html' else '' }}">
                                    <span>Precio</span>
                                </th>
                                <th style="padding:0px" name="th_price_unit" t-if="display_discount" t-attf-class="text-right {{ 'd-none d-md-table-cell' if report_type == 'html' else '' }}">
                                    <span>Desc.%</span>
                                    <!-- TODO: remove in master -->
                                    <t t-set="colspan" t-value="colspan+1"/>
                                </th>
                                <th style="padding:0px" name="th_subtotal" class="text-right">
                                    <span groups="account.group_show_line_subtotals_tax_excluded">Total</span>
                                    <span groups="account.group_show_line_subtotals_tax_included">Total</span>
                                </th>
                            </tr>
                        </thead>
                        <tbody class="invoice_tbody">
                            <t t-set="current_subtotal" t-value="0"/>
                            <t t-set="total" t-value="0"/>
                            <t t-set="total_disc" t-value="0"/>
                            <t t-set="lines" t-value="o.invoice_line_ids.sorted(key=lambda l: (-l.sequence, l.date, l.move_name, -l.id), reverse=True)"/>
                            <t t-foreach="lines" t-as="line">
                                <t t-if="line.discount">
                                    <t t-set="line_disc" t-value="line.discount / 100"/>
                                    <t t-set="cuant" t-value="line.price_unit * line.quantity"/>
                                    <t t-set="total" t-value="cuant * line_disc"/>
                                    <t t-set="total_disc" t-value="total_disc + total"/></t>
                                <t t-set="current_subtotal" t-value="current_subtotal + line.price_subtotal" groups="account.group_show_line_subtotals_tax_excluded"/>
                                <t t-set="current_subtotal" t-value="current_subtotal + line.price_total" groups="account.group_show_line_subtotals_tax_included"/>
                                <tr style="font-size:13px" t-att-class="'bg-200 font-weight-bold o_line_section' if line.display_type == 'line_section' else 'font-italic o_line_note' if line.display_type == 'line_note' else ''">
                                    <t t-if="not line.display_type" name="account_invoice_line_accountable">
                                        <td name="account_invoice_line_name" style="padding:0px">
                                            <span t-field="line.name" t-options="{'widget': 'text'}"/>
                                        </td>
                                        <td class="text-right" style="padding:0px">
                                            <span t-field="line.quantity"/>
                                        </td>
                                        <td class="text-right" style="padding:0px">
                                            <span t-field="line.product_id.uom_id"/>
                                        </td>
                                        <td style="padding:0px" t-attf-class="text-right {{ 'd-none d-md-table-cell' if report_type == 'html' else '' }}">
                                            <span class="text-nowrap" t-field="line.price_unit"/>
                                        </td>
                                        <td style="padding:0px" t-if="display_discount" t-attf-class="text-right {{ 'd-none d-md-table-cell' if report_type == 'html' else '' }}">
                                            <span class="text-nowrap" t-field="line.discount"/>
                                        </td>
                                        <td style="padding:0px" class="text-right o_price_total">
                                            <span class="text-nowrap" t-field="line.price_subtotal" groups="account.group_show_line_subtotals_tax_excluded"/>
                                            <span class="text-nowrap" t-field="line.price_total" groups="account.group_show_line_subtotals_tax_included"/>
                                        </td>
                                    </t>
                                </tr>
                                <!--<t t-if="current_section and (line_last or lines[line_index+1].display_type == 'line_section')">-->
                                <!--    <tr class="is-subtotal text-right">-->
                                <!--        <td colspan="99" style="padding:0px">-->
                                <!--            <strong class="mr16">Subtotal</strong>-->
                                <!--            <span t-esc="current_subtotal" t-options="{&quot;widget&quot;: &quot;monetary&quot;, &quot;display_currency&quot;: o.currency_id}"/>-->
                                <!--        </td>-->
                                <!--    </tr>-->
                                <!--</t>-->
                            </t>
                        </tbody>
                    </table>
                    <div class="clearfix" >
                    <div id="total" class="row">
                        <div class="col-6">
                            <t t-if="o.currency_id.name == 'USD'">
                                <span>
                                <b>Tasa de cambio:</b>
                                </span>
                                <t t-if="o.currency_id.name == 'USD'">
                                <span t-esc="'{0:,.4f}'.format(1/o.type_currencychange_usd)"/>
                                </t>
                                <t t-if="o.currency_id.name == 'NIO'">
                                <span t-esc="'{0:,.4f}'.format(1/o.type_currencychange_nic)"/>
                                </t>
                                <br/>

                                <span>
                                    <b>Total en C$:</b>
                                </span>
                                <t t-if="o.currency_id.name == 'USD'">
                                <span t-esc="'{0:,.2f}'.format(o.amount_total / o.type_currencychange_usd )"/>
                                </t>
                                <t t-if="o.currency_id.name == 'NIO'">
                                <span t-esc="'{0:,.2f}'.format( o.amount_total / o.type_currencychange_nic )"/>
                                </t>
                                </t>


                        </div>

                        <div t-attf-class="col-6">
                             <!--<div t-attf-class="#{'col-6' if report_type != 'html' else 'col-sm-7 col-md-6'} ml-auto">-->
                            <table class="table table-sm" style="page-break-inside: avoid;">
                                <tr class="border-black o_subtotal" style="padding-bottom:0px !important">
                                    <td style="padding-bottom:0px !important; padding-top:0px !important">
                                        <strong>Subtotal</strong>
                                    </td>
                                    <td class="text-right" style="padding-bottom:0px !important; padding-top:0px !important">
                                        <span t-field="o.amount_untaxed"/>
                                    </td>
                                </tr>
                                <t t-foreach="o.amount_by_group" t-as="amount_by_group">
                                        <tr style="">
                                            <t t-if="len(o.line_ids.filtered(lambda line: line.tax_line_id)) == 1 and o.amount_untaxed == amount_by_group[2]">
                                                <td style="padding:0px !important">
                                                    <!--<span class="text-nowrap" t-esc="amount_by_group[0]"/>-->
                                                    <span class="">
                                                        <strong>I.V.A</strong>
                                                    </span>
                                                </td>
                                                <td class="text-right o_price_total" style="padding-bottom:0px !important">
                                                    <span class="text-nowrap" t-esc="amount_by_group[3]"/>
                                                </td>
                                            </t>
                                            <t t-else="">
                                                <td style="padding:0px !important">
                                                    <span class="">
                                                        <strong>I.V.A</strong>
                                                    </span>
                                                    <!--<span t-esc="amount_by_group[0]"/>-->
                                                    <!--<span class="text-nowrap"> on-->
                                                    <!--    <t t-esc="amount_by_group[4]"/>-->
                                                    <!--</span>-->
                                                </td>
                                                <td class="text-right o_price_total" style="padding:0px !important">
                                                    <span class="text-nowrap" t-esc="amount_by_group[3]"/>
                                                </td>
                                            </t>
                                        </tr>
                                    </t>
<!--                                    <tr style="">-->
<!--                                        <td style="padding:0px !important">-->
<!--                                            <span class="">-->
<!--                                                <strong>Desc.</strong>-->
<!--                                            </span>-->
<!--                                        </td>-->
<!--                                        <td class="text-right o_price_total" style="padding:0px !important">-->
<!--                                            <span class="text-nowrap" t-esc="total_disc" t-options="{&quot;widget&quot;: &quot;monetary&quot;, &quot;display_currency&quot;: o.currency_id}"/>-->
<!--                                        </td>-->
<!--                                    </tr>-->
                                <tr class="border-black o_total">
                                        <td style="padding:0px !important">
                                            <strong>Total</strong>
                                        </td>
                                        <td class="text-right" style="padding:0px !important">
                                            <span class="text-nowrap" t-field="o.amount_total"/>
                                        </td>
                                    </tr>
<!--                                <t t-if="o.invoice_payments_widget != 'false'">-->
<!--                                    <t t-foreach="o.invoice_payments_widget_aux(o)" t-as="line">-->
<!--                                        <tr>-->
<!--                                             <td style="padding-bottom:0px !important; padding-top:0px !important">-->
<!--                                                <span>-->
<!--                                                    <strong>Pagado en </strong>-->
<!--                                                    <t t-set="date_aux" t-value="datetime.datetime.strptime(line['date'], '%Y-%m-%d')"/>-->
<!--&lt;!&ndash;                                                    <t t-esc="datetime.datetime.strptime(line['date'], '%Y-%m-%d')"></t>&ndash;&gt;-->
<!--                                                    <t t-esc="date_aux.strftime('%d/%m/%Y')"></t>-->
<!--                                                </span>-->
<!--                                            </td>-->
<!--                                            <td class="text-right" style="padding-bottom:0px !important; padding-top:0px !important">-->
<!--                                                <t t-esc="line['amount']" t-options="{&quot;widget&quot;: &quot;monetary&quot;, &quot;display_currency&quot;: o.currency_id}"></t>-->
<!--&lt;!&ndash;                                                t-value="datetime.datetime.strptime(date_end, '%Y-%m-%d')"&ndash;&gt;-->
<!--                                            </td>-->

<!--                                        </tr>-->
<!--                                    </t>-->
<!--                                </t>-->



<!--                                <tr >-->
<!--                                    <td style="padding-bottom:0px !important; padding-top:0px !important">-->
<!--                                        <span>-->
<!--                                            <strong>Pagado en </strong>-->
<!--                                        </span>-->
<!--                                    </td>-->
<!--                                    <td class="text-right" style="padding-bottom:0px !important; padding-top:0px !important">-->

<!--&lt;!&ndash;                                         <t t-set="lines" t-value="o._get_payments_vals()"/>&ndash;&gt;-->

<!--&lt;!&ndash;                                            <t t-foreach="lines" t-as="line">&ndash;&gt;-->
<!--&lt;!&ndash;                                                <tr>&ndash;&gt;-->
<!--&lt;!&ndash;                                                    <td style="width: 150px;">&ndash;&gt;-->
<!--&lt;!&ndash;                                                    <span><strong>Pagado en </strong></span>&ndash;&gt;-->
<!--&lt;!&ndash;                                                    <t t-esc="line['date'].strftime('%d/%m/%Y')"></t>&ndash;&gt;-->
<!--&lt;!&ndash;                                                    </td>&ndash;&gt;-->
<!--&lt;!&ndash;                                                    <td> <span style="color:white">.</span> </td>&ndash;&gt;-->
<!--&lt;!&ndash;                                                    <td><t t-esc="line['amount']" t-options="{&quot;widget&quot;: &quot;monetary&quot;, &quot;display_currency&quot;: o.currency_id}"></t> </td>&ndash;&gt;-->
<!--&lt;!&ndash;                                                </tr>&ndash;&gt;-->
<!--&lt;!&ndash;            &ndash;&gt;-->
<!--&lt;!&ndash;                                            </t>&ndash;&gt;-->




<!--                                        <t t-if="o.invoice_payments_widget != 'false'">-->

<!--                                            <span class="text-nowrap" t-esc="o.invoice_payments_widget_aux(o)"/>-->
<!--                                        </t>-->

<!--                                    </td>-->
<!--                                </tr>-->

<!--                                <t t-if="o.amount_residual > 0">-->
<!--                                    <tr>-->
<!--                                    <td style="padding-bottom:0px !important; padding-top:0px !important">-->
<!--                                        <span>-->
<!--                                            <strong>Importe adeudado  </strong>-->
<!--                                        </span>-->
<!--                                    </td>-->
<!--                                    <td class="text-right" style="padding-bottom:0px !important; padding-top:0px !important">-->
<!--                                        <t t-if="o.currency_id.name == 'USD'">-->
<!--                                            <span> $ </span> <span t-esc="o.amount_residual"/>-->
<!--                                        </t>-->
<!--                                        <t t-if="o.currency_id.name == 'NIO'">-->
<!--                                            <span> C$ </span> <span t-esc="o.amount_residual"/>-->
<!--                                        </t>-->
<!--                                    </td>-->
<!--                                </tr>-->
<!--                                </t>-->


                            </table>
                        </div>
                    </div>
                </div>
                </div>
            </t>
                </t>



            </t>
        </t>

    </template>



    <record model="report.paperformat" id="paperformat_itc_inv_reports">
        <field name="name">paperformat.asset.itc.inv.report</field>
        <field name="default" eval="True"/>
        <field name="format">Letter</field>
        <!--<field name="page_width">0</field>-->
        <!--<field name="page_width">0</field>-->
        <field name="orientation">Portrait</field>
        <!--<field name="orientation">Landscape</field>-->
        <field name="margin_top">45</field>
        <field name="margin_right">7</field>
        <field name="margin_bottom">20</field>
        <field name="margin_left">7</field>
        <field name="header_line" eval="False"/>
        <field name="header_spacing">35</field>
        <field name="dpi">90</field>
    </record>

    <report id = "report_custom_itc_inv"
            string = "FACTURA"
            model ="account.move"
            paperformat="paperformat_itc_inv_reports"
            file="FACTURA"
            report_type = "qweb-pdf"
            name="l10n_ni_formatos_dgi.report_itc_inv_template"

    />

    <template id = "report_itc_inv_template">
         <t t-foreach="docs" t-as="o">
            <t t-call="web.html_container">

                <t t-if="o.external_layout_aux('factura') == 'true'">
                     <t t-call="web.external_layout">
                        <div class="page" style="font-size:15px">
                <div style="margin-top:0px !important; text-align: center;"/>

                <div class="row" >
                    <div class="col-6" style="padding:0px !important; color:white">

                         </div>
                    <div class="col-6 text-right">
                        <span><b>Factura:</b></span> <b><span t-if="o.name" t-field="o.name"/></b>

                    </div>
                </div>
                <div class="row">
                    <div class="col-5" style="padding:0px;white-space:nowrap; overflow:hidden; text-overflow: ellipsis;">
                        <span><b>Cliente:</b></span> <span t-if="o.partner_id" t-field="o.partner_id.name"/>
                    </div>
                    <!--<div class="col-5" style=" white-space:nowrap; overflow:hidden; text-overflow: ellipsis;">-->

                    <!--</div>-->
<!--                    <div class="col-3" style="padding:0px">-->
<!--                        <span><b>RUC:</b></span> <span t-if="o.partner_id.vat" t-field="o.partner_id.vat"/>-->
<!--                    </div>-->

<!--                    <div class="col-4" style="padding:0px">-->
<!--                        <span><b>Fecha:</b></span> <span t-field="o.invoice_date"/>-->
<!--                    </div>-->

                </div>
                <div class="row" style="margin-bottom:0px !important">
                    <!--<div class="col-1" style="padding:0px"><b>Dirección:</b></div>-->
                    <div style="padding:0px; white-space:nowrap; overflow:hidden; text-overflow: ellipsis;">
                        <span><b>Dirección:</b></span>
                        <t t-if="o.partner_id.street">
                            <span t-field="o.partner_id.street"/>
                        </t>
                        <t t-if="o.partner_id.street2 and o.partner_id.street">
                                ,
                            </t>
                        <t t-if="o.partner_id.street2">
                            <span t-field="o.partner_id.street2"/>
                        </t>
                        <t t-if="o.partner_id.state_id">
                                ,



                            <span t-field="o.partner_id.state_id.name"/>
                        </t>
                        <t t-if="o.partner_id.city">
                                ,



                            <span t-field="o.partner_id.city"/>
                        </t>
                        <t t-if="o.partner_id.country_id">
                                ,



                            <span t-field="o.partner_id.country_id.name"/>
                        </t>
                    </div>
<!--                     <div class="col-3" style="padding:0px">-->
<!--                        <span><b>Teléf:</b></span> <span t-if="o.partner_id.phone" t-field="o.partner_id.phone"/>-->
<!--                    </div>-->
<!--                     <div class="col-4" style="padding:0px">-->
<!--                        <span><b>Forma de Pago:</b></span> <span t-if="o.invoice_payment_term_id" t-field="o.invoice_payment_term_id.name"/>-->
<!--                    </div>-->
                </div>

                <div class="row">
                    <div class="col-5" style="padding:0px;white-space:nowrap; overflow:hidden; text-overflow: ellipsis;">
                        <span><b>RUC:</b></span> <span t-if="o.partner_id.vat" t-field="o.partner_id.vat"/>
                    </div>
                    <!--<div class="col-5" style=" white-space:nowrap; overflow:hidden; text-overflow: ellipsis;">-->

                    <!--</div>-->
                    <div class="col-3" style="padding:0px">
                        <span><b>Fecha:</b></span> <span t-field="o.invoice_date"/>
                    </div>

                    <div class="col-4" style="padding:0px">
                        <span><b>Vencimiento:</b></span>
<!--                        <t t-set="date_aux_venci" t-value="datetime.datetime.strptime(o.invoice_payment_term_id, '%Y-%m-%d')"/>-->

<!--                        <t t-esc="date_aux_venci.strftime('%d/%m/%Y')"/>-->

                        <t t-if="o.invoice_payment_term_id">
                            <span t-if="o.invoice_payment_term_id" t-field="o.invoice_payment_term_id"/>
                        </t>
                        <t t-if="not o.invoice_payment_term_id">
                            <span t-if="o.invoice_date_due" t-field="o.invoice_date_due"/>
                        </t>



<!--                        <span t-field="o.invoice_payment_term_id"/>-->
                    </div>

                </div>
                <!--<div class="row" style=" ">-->

                    <!--<div class="col-1" style="">-->
                        <!--<span><b>Teléf:</b></span>-->
                    <!--</div>-->
                    <!--<div class="col-3">-->
                        <!--<span t-if="o.partner_id.phone" t-field="o.partner_id.phone"/>-->
                    <!--</div>-->
                    <!--<div class="col-2" style=""><b>Forma de Pago:</b></div>-->
                    <!--<div class="col-3" style="padding-left:0px !important">-->
                        <!--<span t-if="o.invoice_payment_term_id" t-field="o.invoice_payment_term_id.name"/>-->
                    <!--</div>-->
                <!--</div>-->
<!--                <div style="height:122px !important;padding:0px ">-->
                    <table class="table table-sm o_main_table" style="margin-top:5px;padding:0px  " name="invoice_line_table">
                        <thead style="padding:0px">
                            <tr style="padding:0px">
                                <th name="Cant" class="text-left">
                                    <span>Código</span>
                                </th>
                                <th name="Cant" class="text-left">
                                    <span>Descripción</span>
                                </th>
                                <th name="Cant" class="text-center">
                                    <span>Cant</span>
                                </th>
                                <th name="udm" class="text-center">
                                    <span>UdM</span>
                                </th>

                                <th name="Cant" class="text-right">
                                    <span>Precio</span>
                                </th>
                                <th name="descento" class="text-right">
                                    <span>Desc.%</span>
                                </th>
                                <th name="Cant" class="text-right">
                                    <span>Total</span>
                                </th>
                            </tr>
                        </thead>
                        <tbody class="invoice_tbody" style="padding:0px; font-size:13px">
                            <t t-set="current_subtotal" t-value="0"/>
                            <t t-set="cuant" t-value="0"/>
                            <t t-set="line_disc" t-value="0"/>
                            <t t-set="total" t-value="0"/>
                            <t t-set="total_disc" t-value="0"/>
                            <!--<t t-set="lines" t-value="o.invoice_line_ids.sorted(key=lambda l: (-l.sequence, l.move_name, -l.id), reverse=True)"/>-->
                            <t t-foreach="o.invoice_line_ids" t-as="line">
                                <t t-set="line_disc" t-value="line.discount / 100"/>
                                <t t-set="cuant" t-value="line.price_unit * line.quantity"/>
                                <t t-set="total" t-value="cuant * line_disc"/>
                                <!--<t t-set="total_disc" t-value="total_disc + total"/>-->
                                <t t-set="current_subtotal" t-value="current_subtotal + line.price_subtotal" groups="account.group_show_line_subtotals_tax_excluded"/>
                                <t t-set="current_subtotal" t-value="current_subtotal + line.price_total" groups="account.group_show_line_subtotals_tax_included"/>
                                <tr style="border:hidden !important">
                                    <!--<t t-if="not line.display_type" name="account_invoice_line_accountable">-->
                                    <td class="text-left" style="padding-left:1px;width:24px;padding-bottom:0px !important; padding-top:0px !important">
                                        <span t-field="line.product_id.default_code"/>
                                    </td>
                                    <td class="text-left" style="width:360px; padding-bottom:0px !important; padding-top:0px !important">
                                        <span t-field="line.product_id.name"/>
                                    </td>
                                    <td name="account_invoice_line_name" class="text-center" style="padding-left:1px; width:36px;padding-bottom:0px !important; padding-top:0px !important">
                                        <span t-field="line.quantity"/>
                                    </td>

                                    <td name="account_invoice_line_name" class="text-center" style="padding-left:1px; width:36px;padding-bottom:0px !important; padding-top:0px !important">
                                        <span t-field="line.product_id.uom_id"/>
                                    </td>


                                    <td name="account_invoice_line_name" class="text-right" style="padding-bottom:0px !important;padding-left:1px;width:20px;; padding-top:0px !important">
                                        <span t-field="line.price_unit"/>
                                    </td>
                                    <td name="account_invoice_line_name" class="text-right" style="padding-bottom:0px !important;padding-left:1px;width:20px;; padding-top:0px !important">
<!--                                        <span t-esc="line.discount"/>-->
                                        <span t-esc="'{0:,.2f}'.format(line.discount)"/>
                                    </td>

                                    <td class=" o_price_total text-right" style="width:120px;padding-bottom:0px !important; padding-top:0px !important">
                                        <span class="text-nowrap" t-field="line.price_subtotal" groups="account.group_show_line_subtotals_tax_excluded"/>
                                        <span class="text-nowrap" t-field="line.price_total" groups="account.group_show_line_subtotals_tax_included"/>
                                    </td>
                                    <!--</t>-->
                                </tr>
                            </t>
                        </tbody>
                    </table>
<!--                </div>-->
                <div class="clearfix">
                    <div id="total" class="row">
                        <div class="col-6">
                            <t t-if="o.currency_id.name == 'USD'">
                                <span>
                                <b>Tasa de cambio:</b>
                                </span>
                                <t t-if="o.currency_id.name == 'USD'">
                                <span t-esc="'{0:,.4f}'.format(1/o.type_currencychange_usd)"/>
                                </t>
                                <t t-if="o.currency_id.name == 'NIO'">
                                <span t-esc="'{0:,.4f}'.format(1/o.type_currencychange_nic)"/>
                                </t>
                                <br/>

                                <span>
                                    <b>Total en C$:</b>
                                </span>
                                <t t-if="o.currency_id.name == 'USD'">
                                <span t-esc="'{0:,.2f}'.format(o.amount_total / o.type_currencychange_usd )"/>
                                </t>
                                <t t-if="o.currency_id.name == 'NIO'">
                                <span t-esc="'{0:,.2f}'.format( o.amount_total / o.type_currencychange_nic )"/>
                                </t>
                                </t>
                                <br/>
                                 <t t-if="o.withholdings">
                                    <span>

<!--                                        <t t-set="retenciones" t-value=""/>-->
                                        <b>Retenciones: </b>
                                        <br/>
                                        <t t-foreach="o.withholdings" t-as="reten">

                                            <span t-esc="reten.name"/>
                                            <br/>
<!--                                            <t t-if="o.retenciones == ''">-->
<!--                                                <t t-set="retenciones" t-value="reten.name"/>       -->
<!--                                            </t>-->
                                        </t>

                                    </span>
                                </t>


                        </div>
                        <div t-attf-class="col-6">
                             <!--<div t-attf-class="#{'col-6' if report_type != 'html' else 'col-sm-7 col-md-6'} ml-auto">-->
                            <table class="table table-sm" style="page-break-inside: avoid;">
                                <tr class="border-black o_subtotal" style="padding-bottom:0px !important">
                                    <td style="padding-bottom:0px !important; padding-top:0px !important">
                                        <strong>Subtotal</strong>
                                    </td>
                                    <td class="text-right" style="padding-bottom:0px !important; padding-top:0px !important">
                                        <span t-field="o.amount_untaxed"/>
                                    </td>
                                </tr>
                                <tr>
                                    <td style="padding-bottom:0px !important; padding-top:0px !important">
                                        <span class="">
                                            <strong>I.V.A</strong>
                                        </span>
                                    </td>
                                    <td class="text-right o_price_total" style="padding-bottom:0px !important; padding-top:0px !important">
                                        <span class="text-nowrap" t-field="o.amount_tax"/>
                                    </td>
                                </tr>
<!--                                <tr style="">-->
<!--                                    <td style="padding-bottom:0px !important; padding-top:0px !important">-->
<!--                                        <span class="">-->
<!--                                            <strong>Descuento</strong>-->
<!--                                        </span>-->
<!--                                    </td>-->
<!--                                    <td class="text-right o_price_total" style="padding-bottom:0px !important; padding-top:0px !important">-->
<!--                                        <span class="text-nowrap" t-esc="total_disc" t-options="{&quot;widget&quot;: &quot;monetary&quot;, &quot;display_currency&quot;: o.currency_id}"/>-->
<!--                                    </td>-->
<!--                                </tr>-->
                                <tr class="border-black o_total">
                                    <td style="padding-top:0px !important">
                                        <strong>Total</strong>
                                    </td>
                                    <td class="text-right" style="padding-top:0px !important">
                                        <span class="text-nowrap" t-field="o.amount_total"/>
                                    </td>
                                </tr>
                                <t t-if="o.invoice_payments_widget != 'false'">
                                    <t t-foreach="o.invoice_payments_widget_aux(o)" t-as="line">
                                        <tr>
                                             <td style="padding-bottom:0px !important; padding-top:0px !important">
                                                <span>
                                                    <strong>Pagado en </strong>
                                                    <t t-set="date_aux" t-value="datetime.datetime.strptime(line['date'], '%Y-%m-%d')"/>
<!--                                                    <t t-esc="datetime.datetime.strptime(line['date'], '%Y-%m-%d')"></t>-->
                                                    <t t-esc="date_aux.strftime('%d/%m/%Y')"/>
                                                </span>
                                            </td>
                                            <td class="text-right" style="padding-bottom:0px !important; padding-top:0px !important">
                                                <t t-esc="line['amount']" t-options="{&quot;widget&quot;: &quot;monetary&quot;, &quot;display_currency&quot;: o.currency_id}"/>
<!--                                                t-value="datetime.datetime.strptime(date_end, '%Y-%m-%d')"-->
                                            </td>

                                        </tr>
                                    </t>
                                </t>



<!--                                <tr >-->
<!--                                    <td style="padding-bottom:0px !important; padding-top:0px !important">-->
<!--                                        <span>-->
<!--                                            <strong>Pagado en </strong>-->
<!--                                        </span>-->
<!--                                    </td>-->
<!--                                    <td class="text-right" style="padding-bottom:0px !important; padding-top:0px !important">-->

<!--&lt;!&ndash;                                         <t t-set="lines" t-value="o._get_payments_vals()"/>&ndash;&gt;-->

<!--&lt;!&ndash;                                            <t t-foreach="lines" t-as="line">&ndash;&gt;-->
<!--&lt;!&ndash;                                                <tr>&ndash;&gt;-->
<!--&lt;!&ndash;                                                    <td style="width: 150px;">&ndash;&gt;-->
<!--&lt;!&ndash;                                                    <span><strong>Pagado en </strong></span>&ndash;&gt;-->
<!--&lt;!&ndash;                                                    <t t-esc="line['date'].strftime('%d/%m/%Y')"></t>&ndash;&gt;-->
<!--&lt;!&ndash;                                                    </td>&ndash;&gt;-->
<!--&lt;!&ndash;                                                    <td> <span style="color:white">.</span> </td>&ndash;&gt;-->
<!--&lt;!&ndash;                                                    <td><t t-esc="line['amount']" t-options="{&quot;widget&quot;: &quot;monetary&quot;, &quot;display_currency&quot;: o.currency_id}"></t> </td>&ndash;&gt;-->
<!--&lt;!&ndash;                                                </tr>&ndash;&gt;-->
<!--&lt;!&ndash;            &ndash;&gt;-->
<!--&lt;!&ndash;                                            </t>&ndash;&gt;-->




<!--                                        <t t-if="o.invoice_payments_widget != 'false'">-->

<!--                                            <span class="text-nowrap" t-esc="o.invoice_payments_widget_aux(o)"/>-->
<!--                                        </t>-->

<!--                                    </td>-->
<!--                                </tr>-->

<!--                                <t t-if="o.amount_residual">-->
                                    <tr>
                                    <td style="padding-bottom:0px !important; padding-top:0px !important">
                                        <span>
                                            <strong>Importe adeudado  </strong>
                                        </span>
                                    </td>
                                    <td class="text-right" style="padding-bottom:0px !important; padding-top:0px !important">
                                        <t t-if="o.currency_id.name == 'USD'">
                                            <span> $ </span> <span t-esc="o.amount_residual"/>
                                        </t>
                                        <t t-if="o.currency_id.name == 'NIO'">
                                            <span> C$ </span> <span t-esc="o.amount_residual"/>
                                        </t>
                                    </td>
                                </tr>
<!--                                </t>-->


                            </table>
                        </div>
                    </div>

                </div>

                </div>
            </t>
                </t>

                <t t-if="o.external_layout_aux('factura') == 'false'">
                     <t t-call="web.basic_layout">
                    <div class="page" style="font-size:15px">
                <div style="margin-top:0px !important; text-align: center;"/>

                <div class="row" >
                    <div class="col-6" style="padding:0px !important; color:white">

                         </div>
                    <div class="col-6 text-right">
                        <span><b>Factura:</b></span> <b><span t-if="o.name" t-field="o.name"/></b>

                    </div>
                </div>
                <div class="row">
                    <div class="col-5" style="padding:0px;white-space:nowrap; overflow:hidden; text-overflow: ellipsis;">
                        <span><b>Cliente:</b></span> <span t-if="o.partner_id" t-field="o.partner_id.name"/>
                    </div>
                    <!--<div class="col-5" style=" white-space:nowrap; overflow:hidden; text-overflow: ellipsis;">-->

                    <!--</div>-->
<!--                    <div class="col-3" style="padding:0px">-->
<!--                        <span><b>RUC:</b></span> <span t-if="o.partner_id.vat" t-field="o.partner_id.vat"/>-->
<!--                    </div>-->

<!--                    <div class="col-4" style="padding:0px">-->
<!--                        <span><b>Fecha:</b></span> <span t-field="o.invoice_date"/>-->
<!--                    </div>-->

                </div>
                <div class="row" style="margin-bottom:0px !important">
                    <!--<div class="col-1" style="padding:0px"><b>Dirección:</b></div>-->
                    <div style="padding:0px; white-space:nowrap; overflow:hidden; text-overflow: ellipsis;">
                        <span><b>Dirección:</b></span>
                        <t t-if="o.partner_id.street">
                            <span t-field="o.partner_id.street"/>
                        </t>
                        <t t-if="o.partner_id.street2 and o.partner_id.street">
                                ,
                            </t>
                        <t t-if="o.partner_id.street2">
                            <span t-field="o.partner_id.street2"/>
                        </t>
                        <t t-if="o.partner_id.state_id">
                                ,



                            <span t-field="o.partner_id.state_id.name"/>
                        </t>
                        <t t-if="o.partner_id.city">
                                ,



                            <span t-field="o.partner_id.city"/>
                        </t>
                        <t t-if="o.partner_id.country_id">
                                ,



                            <span t-field="o.partner_id.country_id.name"/>
                        </t>
                    </div>
<!--                     <div class="col-3" style="padding:0px">-->
<!--                        <span><b>Teléf:</b></span> <span t-if="o.partner_id.phone" t-field="o.partner_id.phone"/>-->
<!--                    </div>-->
<!--                     <div class="col-4" style="padding:0px">-->
<!--                        <span><b>Forma de Pago:</b></span> <span t-if="o.invoice_payment_term_id" t-field="o.invoice_payment_term_id.name"/>-->
<!--                    </div>-->
                </div>

                <div class="row">
                    <div class="col-5" style="padding:0px;white-space:nowrap; overflow:hidden; text-overflow: ellipsis;">
                        <span><b>RUC:</b></span> <span t-if="o.partner_id.vat" t-field="o.partner_id.vat"/>
                    </div>
                    <!--<div class="col-5" style=" white-space:nowrap; overflow:hidden; text-overflow: ellipsis;">-->

                    <!--</div>-->
                    <div class="col-3" style="padding:0px">
                        <span><b>Fecha:</b></span> <span t-field="o.invoice_date"/>
                    </div>

                    <div class="col-4" style="padding:0px">
                        <span><b>Vencimiento:</b></span>
<!--                        <t t-set="date_aux_venci" t-value="datetime.datetime.strptime(o.invoice_payment_term_id, '%Y-%m-%d')"/>-->

<!--                        <t t-esc="date_aux_venci.strftime('%d/%m/%Y')"/>-->

                        <t t-if="o.invoice_payment_term_id">
                            <span t-if="o.invoice_payment_term_id" t-field="o.invoice_payment_term_id"/>
                        </t>
                        <t t-if="not o.invoice_payment_term_id">
                            <span t-if="o.invoice_date_due" t-field="o.invoice_date_due"/>
                        </t>



<!--                        <span t-field="o.invoice_payment_term_id"/>-->
                    </div>

                </div>
                <!--<div class="row" style=" ">-->

                    <!--<div class="col-1" style="">-->
                        <!--<span><b>Teléf:</b></span>-->
                    <!--</div>-->
                    <!--<div class="col-3">-->
                        <!--<span t-if="o.partner_id.phone" t-field="o.partner_id.phone"/>-->
                    <!--</div>-->
                    <!--<div class="col-2" style=""><b>Forma de Pago:</b></div>-->
                    <!--<div class="col-3" style="padding-left:0px !important">-->
                        <!--<span t-if="o.invoice_payment_term_id" t-field="o.invoice_payment_term_id.name"/>-->
                    <!--</div>-->
                <!--</div>-->
<!--                <div style="height:122px !important;padding:0px ">-->
                    <table class="table table-sm o_main_table" style="margin-top:5px;padding:0px  " name="invoice_line_table">
                        <thead style="padding:0px">
                            <tr style="padding:0px">
                                <th name="Cant" class="text-left">
                                    <span>Código</span>
                                </th>
                                <th name="Cant" class="text-left">
                                    <span>Descripción</span>
                                </th>
                                <th name="Cant" class="text-center">
                                    <span>Cant</span>
                                </th>
                                <th name="udm" class="text-center">
                                    <span>UdM</span>
                                </th>

                                <th name="Cant" class="text-right">
                                    <span>Precio</span>
                                </th>
                                <th name="descento" class="text-right">
                                    <span>Desc.%</span>
                                </th>
                                <th name="Cant" class="text-right">
                                    <span>Total</span>
                                </th>
                            </tr>
                        </thead>
                        <tbody class="invoice_tbody" style="padding:0px; font-size:13px">
                            <t t-set="current_subtotal" t-value="0"/>
                            <t t-set="cuant" t-value="0"/>
                            <t t-set="line_disc" t-value="0"/>
                            <t t-set="total" t-value="0"/>
                            <t t-set="total_disc" t-value="0"/>
                            <!--<t t-set="lines" t-value="o.invoice_line_ids.sorted(key=lambda l: (-l.sequence, l.move_name, -l.id), reverse=True)"/>-->
                            <t t-foreach="o.invoice_line_ids" t-as="line">
                                <t t-set="line_disc" t-value="line.discount / 100"/>
                                <t t-set="cuant" t-value="line.price_unit * line.quantity"/>
                                <t t-set="total" t-value="cuant * line_disc"/>
                                <!--<t t-set="total_disc" t-value="total_disc + total"/>-->
                                <t t-set="current_subtotal" t-value="current_subtotal + line.price_subtotal" groups="account.group_show_line_subtotals_tax_excluded"/>
                                <t t-set="current_subtotal" t-value="current_subtotal + line.price_total" groups="account.group_show_line_subtotals_tax_included"/>
                                <tr style="border:hidden !important">
                                    <!--<t t-if="not line.display_type" name="account_invoice_line_accountable">-->
                                    <td class="text-left" style="padding-left:1px;width:24px;padding-bottom:0px !important; padding-top:0px !important">
                                        <span t-field="line.product_id.default_code"/>
                                    </td>
                                    <td class="text-left" style="width:360px; padding-bottom:0px !important; padding-top:0px !important">
                                        <span t-field="line.product_id.name"/>
                                    </td>
                                    <td name="account_invoice_line_name" class="text-center" style="padding-left:1px; width:36px;padding-bottom:0px !important; padding-top:0px !important">
                                        <span t-field="line.quantity"/>
                                    </td>

                                    <td name="account_invoice_line_name" class="text-center" style="padding-left:1px; width:36px;padding-bottom:0px !important; padding-top:0px !important">
                                        <span t-field="line.product_id.uom_id"/>
                                    </td>


                                    <td name="account_invoice_line_name" class="text-right" style="padding-bottom:0px !important;padding-left:1px;width:20px;; padding-top:0px !important">
                                        <span t-field="line.price_unit"/>
                                    </td>
                                    <td name="account_invoice_line_name" class="text-right" style="padding-bottom:0px !important;padding-left:1px;width:20px;; padding-top:0px !important">
<!--                                        <span t-esc="line.discount"/>-->
                                        <span t-esc="'{0:,.2f}'.format(line.discount)"/>
                                    </td>

                                    <td class=" o_price_total text-right" style="width:120px;padding-bottom:0px !important; padding-top:0px !important">
                                        <span class="text-nowrap" t-field="line.price_subtotal" groups="account.group_show_line_subtotals_tax_excluded"/>
                                        <span class="text-nowrap" t-field="line.price_total" groups="account.group_show_line_subtotals_tax_included"/>
                                    </td>
                                    <!--</t>-->
                                </tr>
                            </t>
                        </tbody>
                    </table>
<!--                </div>-->
                <div class="clearfix">
                    <div id="total" class="row">
                        <div class="col-6">
                            <t t-if="o.currency_id.name == 'USD'">
                                <span>
                                <b>Tasa de cambio:</b>
                                </span>
                                <t t-if="o.currency_id.name == 'USD'">
                                <span t-esc="'{0:,.4f}'.format(1/o.type_currencychange_usd)"/>
                                </t>
                                <t t-if="o.currency_id.name == 'NIO'">
                                <span t-esc="'{0:,.4f}'.format(1/o.type_currencychange_nic)"/>
                                </t>
                                <br/>

                                <span>
                                    <b>Total en C$:</b>
                                </span>
                                <t t-if="o.currency_id.name == 'USD'">
                                <span t-esc="'{0:,.2f}'.format(o.amount_total / o.type_currencychange_usd )"/>
                                </t>
                                <t t-if="o.currency_id.name == 'NIO'">
                                <span t-esc="'{0:,.2f}'.format( o.amount_total / o.type_currencychange_nic )"/>
                                </t>
                                </t>
                                <br/>
                                 <t t-if="o.withholdings">
                                    <span>

<!--                                        <t t-set="retenciones" t-value=""/>-->
                                        <t t-foreach="o.withholdings" t-as="reten">
                                            <b>Retenciones: </b>
                                            <span t-esc="reten.name"/>
                                            <br/>
<!--                                            <t t-if="o.retenciones == ''">-->
<!--                                                <t t-set="retenciones" t-value="reten.name"/>       -->
<!--                                            </t>-->
                                        </t>

                                    </span>
                                </t>


                        </div>
                        <div t-attf-class="col-6">
                             <!--<div t-attf-class="#{'col-6' if report_type != 'html' else 'col-sm-7 col-md-6'} ml-auto">-->
                            <table class="table table-sm" style="page-break-inside: avoid;">
                                <tr class="border-black o_subtotal" style="padding-bottom:0px !important">
                                    <td style="padding-bottom:0px !important; padding-top:0px !important">
                                        <strong>Subtotal</strong>
                                    </td>
                                    <td class="text-right" style="padding-bottom:0px !important; padding-top:0px !important">
                                        <span t-field="o.amount_untaxed"/>
                                    </td>
                                </tr>
                                <tr>
                                    <td style="padding-bottom:0px !important; padding-top:0px !important">
                                        <span class="">
                                            <strong>I.V.A</strong>
                                        </span>
                                    </td>
                                    <td class="text-right o_price_total" style="padding-bottom:0px !important; padding-top:0px !important">
                                        <span class="text-nowrap" t-field="o.amount_tax"/>
                                    </td>
                                </tr>
<!--                                <tr style="">-->
<!--                                    <td style="padding-bottom:0px !important; padding-top:0px !important">-->
<!--                                        <span class="">-->
<!--                                            <strong>Descuento</strong>-->
<!--                                        </span>-->
<!--                                    </td>-->
<!--                                    <td class="text-right o_price_total" style="padding-bottom:0px !important; padding-top:0px !important">-->
<!--                                        <span class="text-nowrap" t-esc="total_disc" t-options="{&quot;widget&quot;: &quot;monetary&quot;, &quot;display_currency&quot;: o.currency_id}"/>-->
<!--                                    </td>-->
<!--                                </tr>-->
                                <tr class="border-black o_total">
                                    <td style="padding-top:0px !important">
                                        <strong>Total</strong>
                                    </td>
                                    <td class="text-right" style="padding-top:0px !important">
                                        <span class="text-nowrap" t-field="o.amount_total"/>
                                    </td>
                                </tr>
                                <t t-if="o.invoice_payments_widget != 'false'">
                                    <t t-foreach="o.invoice_payments_widget_aux(o)" t-as="line">
                                        <tr>
                                             <td style="padding-bottom:0px !important; padding-top:0px !important">
                                                <span>
                                                    <strong>Pagado en </strong>
                                                    <t t-set="date_aux" t-value="datetime.datetime.strptime(line['date'], '%Y-%m-%d')"/>
<!--                                                    <t t-esc="datetime.datetime.strptime(line['date'], '%Y-%m-%d')"></t>-->
                                                    <t t-esc="date_aux.strftime('%d/%m/%Y')"/>
                                                </span>
                                            </td>
                                            <td class="text-right" style="padding-bottom:0px !important; padding-top:0px !important">
                                                <t t-esc="line['amount']" t-options="{&quot;widget&quot;: &quot;monetary&quot;, &quot;display_currency&quot;: o.currency_id}"/>
<!--                                                t-value="datetime.datetime.strptime(date_end, '%Y-%m-%d')"-->
                                            </td>

                                        </tr>
                                    </t>
                                </t>



<!--                                <tr >-->
<!--                                    <td style="padding-bottom:0px !important; padding-top:0px !important">-->
<!--                                        <span>-->
<!--                                            <strong>Pagado en </strong>-->
<!--                                        </span>-->
<!--                                    </td>-->
<!--                                    <td class="text-right" style="padding-bottom:0px !important; padding-top:0px !important">-->

<!--&lt;!&ndash;                                         <t t-set="lines" t-value="o._get_payments_vals()"/>&ndash;&gt;-->

<!--&lt;!&ndash;                                            <t t-foreach="lines" t-as="line">&ndash;&gt;-->
<!--&lt;!&ndash;                                                <tr>&ndash;&gt;-->
<!--&lt;!&ndash;                                                    <td style="width: 150px;">&ndash;&gt;-->
<!--&lt;!&ndash;                                                    <span><strong>Pagado en </strong></span>&ndash;&gt;-->
<!--&lt;!&ndash;                                                    <t t-esc="line['date'].strftime('%d/%m/%Y')"></t>&ndash;&gt;-->
<!--&lt;!&ndash;                                                    </td>&ndash;&gt;-->
<!--&lt;!&ndash;                                                    <td> <span style="color:white">.</span> </td>&ndash;&gt;-->
<!--&lt;!&ndash;                                                    <td><t t-esc="line['amount']" t-options="{&quot;widget&quot;: &quot;monetary&quot;, &quot;display_currency&quot;: o.currency_id}"></t> </td>&ndash;&gt;-->
<!--&lt;!&ndash;                                                </tr>&ndash;&gt;-->
<!--&lt;!&ndash;            &ndash;&gt;-->
<!--&lt;!&ndash;                                            </t>&ndash;&gt;-->




<!--                                        <t t-if="o.invoice_payments_widget != 'false'">-->

<!--                                            <span class="text-nowrap" t-esc="o.invoice_payments_widget_aux(o)"/>-->
<!--                                        </t>-->

<!--                                    </td>-->
<!--                                </tr>-->

<!--                                <t t-if="o.amount_residual">-->
                                    <tr>
                                    <td style="padding-bottom:0px !important; padding-top:0px !important">
                                        <span>
                                            <strong>Importe adeudado  </strong>
                                        </span>
                                    </td>
                                    <td class="text-right" style="padding-bottom:0px !important; padding-top:0px !important">
                                        <t t-if="o.currency_id.name == 'USD'">
                                            <span> $ </span> <span t-esc="o.amount_residual"/>
                                        </t>
                                        <t t-if="o.currency_id.name == 'NIO'">
                                            <span> C$ </span> <span t-esc="o.amount_residual"/>
                                        </t>
                                    </td>
                                </tr>
<!--                                </t>-->


                            </table>
                        </div>
                    </div>

                </div>

                </div>
            </t>
                </t>




            </t>
        </t>

    </template>



    <record model="report.paperformat" id="paperformat_recibo_itc_reports">
        <field name="name">Custom recibo de caja media carta</field>
        <field name="default" eval="True"/>
        <field name="format">custom</field>
         <field name="page_height">140</field>
         <field name="page_width">216</field>

        <!--<field name="page_width">0</field>-->
        <!--<field name="page_width">0</field>-->
        <field name="orientation">Portrait</field>
        <!--<field name="orientation">Landscape</field>-->
        <field name="margin_top">45</field>
        <field name="margin_right">7</field>
        <field name="margin_bottom">20</field>
        <field name="margin_left">7</field>
        <field name="header_line" eval="False"/>
        <field name="header_spacing">35</field>
        <field name="dpi">90</field>


    </record>

    <report id = "report_custom_recibo_caja_itc"
            string = "RECIBO DE CAJA"
            model ="account.payment"
            paperformat="paperformat_recibo_itc_reports"
            file="RECIBO DE CAJA"
            report_type = "qweb-pdf"
            name="l10n_ni_formatos_dgi.report_recibo_caja_itc_template"

    />

    <template id = "report_recibo_caja_itc_template">
        <t t-foreach="docs" t-as="o">
            <t t-call="web.html_container">

                <t t-if="o.external_layout_aux('recibo_caja') == 'true'">
                    <t t-call="web.external_layout">
                    <div class="row">
                        <div class="col-3"/>
                        <div class="col-6"/>
                        <div class="col-2" style="font-size: 13px; padding-left:80px !important; ">
                            <!--<t t-if="o.currency_id.name == 'NIO'">-->
                            <!--    <div style="float: left">X</div>-->
                            <!--</t>-->
                            <!--<t t-if="o.currency_id.name == 'USD'">-->
                            <!--    <div style="float: left; margin-left:50px">X</div>-->
                            <!--</t>-->
                        </div>
                    </div>
                    <div class="row">
                        <div class="col-9" style="padding:0px"></div>
                        <div class="col-3" style="padding:0px">
                            <span>
                                <b>Recibo:</b>
                            </span>
                            <span t-field="o.name"/>
                        </div>
                    </div>
                    <div class="row">
                        <div class="col-6" style="padding:0px">
                            <span>
                                <b>Cliente:</b>
                            </span>
                            <span t-if="o.partner_id.name" t-field="o.partner_id.name"/>
                        </div>
                        <div class="col-3" style="padding:0px"/>
                    </div>
                    <div class="row">
                        <div class="col-12" style="padding:0px">
                            <b>Dirección:</b>
                            <t t-if="o.partner_id.street">
                                <span t-field="o.partner_id.street"/>
                            </t>
                            <t t-if="o.partner_id.street2 and o.partner_id.street">
                                ,
                            </t>
                            <t t-if="o.partner_id.street2">
                                <span t-field="o.partner_id.street2"/>
                            </t>
                            <t t-if="o.partner_id.state_id">
                                ,





                                <span t-field="o.partner_id.state_id.name"/>
                            </t>
                            <t t-if="o.partner_id.city">
                                ,





                                <span t-field="o.partner_id.city"/>
                            </t>
                            <t t-if="o.partner_id.country_id">
                                ,





                                <span t-field="o.partner_id.country_id.name"/>
                            </t>
                        </div>
                    </div>
                    <div class="row">
                        <div class="col-6" style="padding:0px">
                            <span>
                                <b>RUC:</b>
                            </span>
                            <span t-if="o.partner_id.vat" t-field="o.partner_id.vat"/>
                        </div>
                        <div class="col-6" style="padding:0px">
                            <span>
                                <b>Fecha:</b>
                            </span>
                            <span t-if="o.date" t-field="o.date"/>
                        </div>
                    </div>
                    <div class="row">
                        <div class="col-4" style="padding:0px">
                            <span>
                                <b>Monto:</b>
                            </span>
                            <span t-field="o.amount"/>
                        </div>
                        <div class="col-4" style="padding:0px">
                            <!--<span>-->
                            <!--    <b>Tasa de cambio:</b>-->
                            <!--</span>-->
                            <!--<span t-esc="'{0:,.4f}'.format(1/o.currency_id.rate)"/>-->
                        </div>
                        <div class="col-4" style="padding:0px">
                            <!--<span>-->
                            <!--    <b>Total en C$:</b>-->
                            <!--</span>-->
                            <!--<span t-field="o.amount_total_company_currency"/>-->
                        </div>
                    </div>
                    <div class="row" style="margin-top:8px; font-size: 16px">
                        <div class="col-3" style="padding:0px">
                            <span>
                                <b>Valor en letras:</b>
                            </span>
                        </div>
                        <div class="col-10" style="">
                            <span t-if="o.text_amount" t-esc="o.text_amount"/>
                        </div>
                    </div>
                    <div class="row" style="margin-top:18px; font-size: 16px; height:134px">
                        <div class="col-3" style="padding:0px">
                            <span>
                                <b>En concepto de:</b>
                            </span>
                        </div>
                        <div class="col-9">
                            <span t-if="o.ref" t-esc="o.ref"/>
                        </div>
                    </div>
                </t>
                </t>
                <t t-if="o.external_layout_aux('recibo_caja') == 'false'">
                     <t t-call="web.basic_layout">
                  <div class="row">
                        <div class="col-3"/>
                        <div class="col-6"/>
                        <div class="col-2" style="font-size: 13px; padding-left:80px !important; ">
                            <!--<t t-if="o.currency_id.name == 'NIO'">-->
                            <!--    <div style="float: left">X</div>-->
                            <!--</t>-->
                            <!--<t t-if="o.currency_id.name == 'USD'">-->
                            <!--    <div style="float: left; margin-left:50px">X</div>-->
                            <!--</t>-->
                        </div>
                    </div>
                    <div class="row">
                        <div class="col-9" style="padding:0px"></div>
                        <div class="col-3" style="padding:0px">
                            <span>
                                <b>Recibo:</b>
                            </span>
                            <span t-field="o.name"/>
                        </div>
                    </div>
                    <div class="row">
                        <div class="col-6" style="padding:0px">
                            <span>
                                <b>Cliente:</b>
                            </span>
                            <span t-if="o.partner_id.name" t-field="o.partner_id.name"/>
                        </div>
                        <div class="col-3" style="padding:0px"/>
                    </div>
                    <div class="row">
                        <div class="col-12" style="padding:0px">
                            <b>Dirección:</b>
                            <t t-if="o.partner_id.street">
                                <span t-field="o.partner_id.street"/>
                            </t>
                            <t t-if="o.partner_id.street2 and o.partner_id.street">
                                ,
                            </t>
                            <t t-if="o.partner_id.street2">
                                <span t-field="o.partner_id.street2"/>
                            </t>
                            <t t-if="o.partner_id.state_id">
                                ,





                                <span t-field="o.partner_id.state_id.name"/>
                            </t>
                            <t t-if="o.partner_id.city">
                                ,





                                <span t-field="o.partner_id.city"/>
                            </t>
                            <t t-if="o.partner_id.country_id">
                                ,





                                <span t-field="o.partner_id.country_id.name"/>
                            </t>
                        </div>
                    </div>
                    <div class="row">
                        <div class="col-6" style="padding:0px">
                            <span>
                                <b>RUC:</b>
                            </span>
                            <span t-if="o.partner_id.vat" t-field="o.partner_id.vat"/>
                        </div>
                        <div class="col-6" style="padding:0px">
                            <span>
                                <b>Fecha:</b>
                            </span>
                            <span t-if="o.date" t-field="o.date"/>
                        </div>
                    </div>
                    <div class="row">
                        <div class="col-4" style="padding:0px">
                            <span>
                                <b>Monto:</b>
                            </span>
                            <span t-field="o.amount"/>
                        </div>
                        <div class="col-4" style="padding:0px">
                            <!--<span>-->
                            <!--    <b>Tasa de cambio:</b>-->
                            <!--</span>-->
                            <!--<span t-esc="'{0:,.4f}'.format(1/o.currency_id.rate)"/>-->
                        </div>
                        <div class="col-4" style="padding:0px">
                            <!--<span>-->
                            <!--    <b>Total en C$:</b>-->
                            <!--</span>-->
                            <!--<span t-field="o.amount_total_company_currency"/>-->
                        </div>
                    </div>
                    <div class="row" style="margin-top:8px; font-size: 16px">
                        <div class="col-3" style="padding:0px">
                            <span>
                                <b>Valor en letras:</b>
                            </span>
                        </div>
                        <div class="col-10" style="">
                            <span t-if="o.text_amount" t-esc="o.text_amount"/>
                        </div>
                    </div>
                    <div class="row" style="margin-top:18px; font-size: 16px; height:134px">
                        <div class="col-3" style="padding:0px">
                            <span>
                                <b>En concepto de:</b>
                            </span>
                        </div>
                        <div class="col-9">
                            <span t-if="o.ref" t-esc="o.ref"/>
                        </div>
                    </div>
                </t>
                </t>



            </t>
        </t>

    </template>




</odoo>